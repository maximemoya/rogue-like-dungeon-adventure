(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,7670,e=>{"use strict";e.s(["default",0,function(){for(var e,t,r=0,i="",s=arguments.length;r<s;r++)(e=arguments[r])&&(t=function e(t){var r,i,s="";if("string"==typeof t||"number"==typeof t)s+=t;else if("object"==typeof t)if(Array.isArray(t)){var n=t.length;for(r=0;r<n;r++)t[r]&&(i=e(t[r]))&&(s&&(s+=" "),s+=i)}else for(i in t)t[i]&&(s&&(s+=" "),s+=i);return s}(e))&&(i&&(i+=" "),i+=t);return i}])},5822,(e,t,r)=>{"use strict";function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function s(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}}function n(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}Object.defineProperty(r,"__esModule",{value:!0});r.Event=function(){var e;function t(){var e,r;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");e="subscribers",r=new Set,(e=n(e))in this?Object.defineProperty(this,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[e]=r}return e=[{key:"onSubscribe",get:function(){return this._onSubscribe||(this._onSubscribe=new t),this._onSubscribe}},{key:"onUnsubscribe",get:function(){return this._onUnsubscribe||(this._onUnsubscribe=new t),this._onUnsubscribe}},{key:"subscribe",value:function(e){var t,r=this;return this.subscribers.add(e),null==(t=this._onSubscribe)||t.emit(e),function(){return r.unsubscribe(e)}}},{key:"unsubscribe",value:function(e){var t;this.subscribers.delete(e),null==(t=this._onUnsubscribe)||t.emit(e)}},{key:"clear",value:function(){if(this._onUnsubscribe){var e,t=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=s(e))){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(l)throw a}}}}(this.subscribers);try{for(t.s();!(e=t.n()).done;){var r=e.value;this._onUnsubscribe.emit(r)}}catch(e){t.e(e)}finally{t.f()}}this.subscribers.clear()}},{key:"emit",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.subscribers.forEach(function(e){return e.apply(void 0,t)})}},{key:"emitAsync",value:function(){for(var e,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return Promise.all(((function(e){if(Array.isArray(e))return i(e)})(e=this.subscribers)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||s(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map(function(e){return e.apply(void 0,r)}))}}],function(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,n(i.key),i)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}()},17747,(e,t,r)=>{"use strict";t.exports=e.r(5822)},11742,77757,e=>{"use strict";let t;var r=e.i(71645);let i=e=>{let t,r=new Set,i=(e,i)=>{let s="function"==typeof e?e(t):e;if(!Object.is(s,t)){let e=t;t=(null!=i?i:"object"!=typeof s||null===s)?s:Object.assign({},t,s),r.forEach(r=>r(t,e))}},s=()=>t,n={setState:i,getState:s,getInitialState:()=>a,subscribe:e=>(r.add(e),()=>r.delete(e))},a=t=e(i,s,n);return n},s=e=>{let t=e?i(e):i,s=e=>(function(e,t=e=>e){let i=r.default.useSyncExternalStore(e.subscribe,r.default.useCallback(()=>t(e.getState()),[e,t]),r.default.useCallback(()=>t(e.getInitialState()),[e,t]));return r.default.useDebugValue(i),i})(t,e);return Object.assign(s,t),s};e.s(["BG_COLOR",0,"#1a1a1a","FALLBACK_TO_ASCII",0,!0,"FONT_SIZE",0,16,"GRID_HEIGHT",0,35,"GRID_WIDTH",0,70,"IMAGE_ASSETS",0,!1,"MAX_INVENTORY_SIZE",0,10,"SPRITE_SIZE",0,16],77757);let n=(t=e=>({hp:100,maxHp:100,attack:0,defense:0,log:[],currentTurn:0,currentFloor:1,gameStatus:"PLAYING",level:1,currentXp:0,nextLevelXp:100,totalXp:0,lastHitTime:0,renderMode:"ascii",triggerHit:()=>e({lastHitTime:Date.now()}),nextFloor:()=>e(e=>({currentFloor:e.currentFloor+1})),setFloor:t=>e({currentFloor:t}),setGameStatus:t=>e({gameStatus:t}),setHp:t=>e({hp:t}),setMaxHp:t=>e({maxHp:t}),setStats:({attack:t,defense:r})=>e({attack:t,defense:r}),addLog:(t,r="white")=>e(e=>({log:[...e.log,{text:t,color:r,turn:e.currentTurn}].slice(-50)})),clearLog:()=>e({log:[]}),incrementTurn:()=>e(e=>({currentTurn:e.currentTurn+1})),setExperience:t=>e({level:t.level,currentXp:t.currentXp,nextLevelXp:t.nextLevelXp,totalXp:t.totalXp}),toggleRenderMode:()=>e(e=>({renderMode:"ascii"===e.renderMode?"sprites":"ascii"}))}))?s(t):s;e.s(["useGameStore",0,n],11742)},15089,47830,42412,55409,69268,34147,36352,15959,90001,40253,e=>{"use strict";var t,r,i,s=e.i(17747);function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function a(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function o(e,t,r){return(t=a(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r=Symbol.iterator;var l=function(){var e;function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!(this instanceof t))throw TypeError("Cannot call a class as a function");o(this,"_version",0),o(this,"onEntityAdded",new s.Event),o(this,"onEntityRemoved",new s.Event),o(this,"entityPositions",new Map),this._entities=e,this.add=this.add.bind(this),this.remove=this.remove.bind(this);for(var r=0;r<e.length;r++)this.entityPositions.set(e[r],r)}return e=[{key:"version",get:function(){return this._version}},{key:"entities",get:function(){return this._entities}},{key:r,value:function(){var e=this,t=this._entities.length,r={value:void 0,done:!1};return{next:function(){return r.value=e._entities[--t],r.done=t<0,r}}}},{key:"size",get:function(){return this.entities.length}},{key:"first",get:function(){return this.entities[0]}},{key:"has",value:function(e){return this.entityPositions.has(e)}},{key:"add",value:function(e){return e&&!this.has(e)&&(this.entities.push(e),this.entityPositions.set(e,this.entities.length-1),this._version++,this.onEntityAdded.emit(e)),e}},{key:"remove",value:function(e){if(this.has(e)){this.onEntityRemoved.emit(e);var t=this.entityPositions.get(e);this.entityPositions.delete(e);var r=this.entities[this.entities.length-1];r!==e&&(this.entities[t]=r,this.entityPositions.set(r,t)),this.entities.pop(),this._version++}return e}},{key:"clear",value:function(){var e,t=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,void 0)}}(e))){r&&(e=r);var i=0,s=function(){};return{s:s,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:s}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(l)throw a}}}}(this);try{for(t.s();!(e=t.n()).done;){var r=e.value;this.remove(r)}}catch(e){t.e(e)}finally{t.f()}}}],function(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(),c=new WeakMap,d=0,h=function(e){var t=c.get(e);return void 0!==t?t:(c.set(e,d),d++)};function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function p(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}}function f(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t);if(i){var s=Object.getOwnPropertyDescriptor(i,t);return s.get?s.get.call(arguments.length<3?e:r):s.value}}).apply(this,arguments)}function y(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=p(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,s=function(){};return{s:s,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:s}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,n=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw n}}}}function b(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function x(e,t,r){return(t=b(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach(function(t){x(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function v(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function w(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,b(i.key),i)}}function A(e,t,r){return t&&w(e.prototype,t),r&&w(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function O(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function R(e,t){return(R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function T(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var r,i=m(e);r=t?Reflect.construct(i,arguments,m(this).constructor):i.apply(this,arguments);if(r&&("object"==typeof r||"function"==typeof r))return r;if(void 0!==r)throw TypeError("Derived constructors may only return object or undefined");return O(this)}}var I=function(e){T(r,e);var t=S(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return v(this,r),x(O(e=t.call(this,i)),"queries",new Set),x(O(e),"entityToId",new Map),x(O(e),"idToEntity",new Map),x(O(e),"nextId",0),e.onEntityAdded.subscribe(function(t){e.reindex(t)}),e.onEntityRemoved.subscribe(function(t){if(e.queries.forEach(function(e){return e.remove(t)}),e.entityToId.has(t)){var r=e.entityToId.get(t);e.idToEntity.delete(r),e.entityToId.delete(t)}}),e}return A(r,[{key:"update",value:function(e){function t(t,r,i){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,r){if("function"==typeof t){var i=t(e);i&&Object.assign(e,i)}else"string"==typeof t?e[t]=r:t&&Object.assign(e,t);return this.reindex(e),e})},{key:"addComponent",value:function(e,t,r){void 0===e[t]&&(e[t]=r,this.reindex(e))}},{key:"removeComponent",value:function(e,t){if(void 0!==e[t]){if(this.has(e)){var r=_({},e);delete r[t],this.reindex(e,r)}delete e[t]}}},{key:"query",value:function(e){var t,r,i={with:N((t=e).with),without:N(t.without),predicates:f(new Set(t.predicates))},s=D(i),n=y(this.queries);try{for(n.s();!(r=n.n()).done;){var a=r.value;if(a.key===s)return a}}catch(e){n.e(e)}finally{n.f()}var o=new M(this,i);return this.queries.add(o),o}},{key:"with",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.query({with:t,without:[],predicates:[]})}},{key:"without",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.query({with:[],without:t,predicates:[]})}},{key:"where",value:function(e){return this.query({with:[],without:[],predicates:[e]})}},{key:"reindex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;if(this.has(e)){var r,i=y(this.queries);try{for(i.s();!(r=i.n()).done;)r.value.evaluate(e,t)}catch(e){i.e(e)}finally{i.f()}}}},{key:"id",value:function(e){if(this.has(e)){if(!this.entityToId.has(e)){var t=this.nextId++;this.entityToId.set(e,t),this.idToEntity.set(t,e)}return this.entityToId.get(e)}}},{key:"entity",value:function(e){return this.idToEntity.get(e)}}]),r}(l);i=Symbol.iterator;var M=function(e){T(r,e);var t=S(r);function r(e,i){var s;return v(this,r),x(O(s=t.call(this)),"_isConnected",!1),s.world=e,s.config=i,s.key=D(i),s.onEntityAdded.onSubscribe.subscribe(function(){return s.connect()}),s.onEntityRemoved.onSubscribe.subscribe(function(){return s.connect()}),s}return A(r,[{key:"isConnected",get:function(){return this._isConnected}},{key:"entities",get:function(){return this._isConnected||this.connect(),g(m(r.prototype),"entities",this)}},{key:i,value:function(){return this._isConnected||this.connect(),g(m(r.prototype),Symbol.iterator,this).call(this)}},{key:"connect",value:function(){if(!this._isConnected){this._isConnected=!0;var e,t=y(this.world);try{for(t.s();!(e=t.n()).done;){var r=e.value;this.evaluate(r)}}catch(e){t.e(e)}finally{t.f()}}return this}},{key:"disconnect",value:function(){return this._isConnected=!1,this}},{key:"with",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.world.query(_(_({},this.config),{},{with:[].concat(f(this.config.with),t)}))}},{key:"without",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.world.query(_(_({},this.config),{},{without:[].concat(f(this.config.without),t)}))}},{key:"where",value:function(e){return this.world.query(_(_({},this.config),{},{predicates:[].concat(f(this.config.predicates),[e])}))}},{key:"want",value:function(e){return this.config.with.every(function(t){return void 0!==e[t]})&&this.config.without.every(function(t){return void 0===e[t]})&&this.config.predicates.every(function(t){return t(e)})}},{key:"evaluate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;if(this.isConnected){var r=this.want(t),i=this.has(e);r&&!i?this.add(e):!r&&i&&this.remove(e)}}}]),r}(l),N=function(e){return f(new Set(e.sort().filter(function(e){return!!e&&""!==e})))};function D(e){return"".concat(e.with.join(","),":").concat(e.without.join(","),":").concat(e.predicates.map(function(e){return h(e)}).join(","))}var L=[];function H(e){L.push(e)}function P(){L.length=0}H.clear=P,H.flush=function(){L.forEach(function(e){return e()}),P()};let k=new I;e.s(["world",0,k],47830);class F{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(e){return e=e<1?1/e:e,this._seed=e,this._s0=(e>>>0)*23283064365386963e-26,e=69069*e+1>>>0,this._s1=23283064365386963e-26*e,e=69069*e+1>>>0,this._s2=23283064365386963e-26*e,this._c=1,this}getUniform(){let e=2091639*this._s0+23283064365386963e-26*this._c;return this._s0=this._s1,this._s1=this._s2,this._c=0|e,this._s2=e-this._c,this._s2}getUniformInt(e,t){let r=Math.max(e,t),i=Math.min(e,t);return Math.floor(this.getUniform()*(r-i+1))+i}getNormal(e=0,t=1){let r,i,s;do s=(r=2*this.getUniform()-1)*r+(i=2*this.getUniform()-1)*i;while(s>1||0==s)return e+r*Math.sqrt(-2*Math.log(s)/s)*t}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(e){return e.length?e[Math.floor(this.getUniform()*e.length)]:null}shuffle(e){let t=[],r=e.slice();for(;r.length;){let e=r.indexOf(this.getItem(r));t.push(r.splice(e,1)[0])}return t}getWeightedValue(e){let t=0;for(let r in e)t+=e[r];let r=this.getUniform()*t,i,s=0;for(i in e)if(r<(s+=e[i]))break;return i}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(e){return this._s0=e[0],this._s1=e[1],this._s2=e[2],this._c=e[3],this}clone(){return new F().setState(this.getState())}}let C=new F().setSeed(Date.now());class G{getContainer(){return null}setOptions(e){this._options=e}}class j extends G{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(e){requestAnimationFrame(e)}getContainer(){return this._ctx.canvas}setOptions(e){super.setOptions(e);let t=e.fontStyle?`${e.fontStyle} `:"",r=`${t} ${e.fontSize}px ${e.fontFamily}`;this._ctx.font=r,this._updateSize(),this._ctx.font=r,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){let e=this._ctx.globalCompositeOperation;this._ctx.globalCompositeOperation="copy",this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.globalCompositeOperation=e}eventToPosition(e,t){let r=this._ctx.canvas,i=r.getBoundingClientRect();return(e-=i.left,t-=i.top,e*=r.width/i.width,t*=r.height/i.height,e<0||t<0||e>=r.width||t>=r.height)?[-1,-1]:this._normalizedEventToPosition(e,t)}}function q(e,t){return(e%t+t)%t}function W(e,t=0,r=1){return e<t?t:e>r?r:e}function U(e){return e.charAt(0).toUpperCase()+e.substring(1)}function Y(e,...t){let r=Y.map;return e.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,function(i,s,n,a){if("%"==e.charAt(a-1))return i.substring(1);if(!t.length)return i;let o=t[0],l=(s||n).split(","),c=l.shift()||"",d=r[c.toLowerCase()];if(!d)return i;let h=(o=t.shift())[d].apply(o,l),u=c.charAt(0);return u!=u.toLowerCase()&&(h=U(h)),h})}Y.map={s:"toString"},e.s(["capitalize",()=>U,"clamp",()=>W,"format",()=>Y,"mod",()=>q],17628);class X extends j{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(e,t){let[r,i,s,n,a]=e,o=[(r+1)*this._spacingX,i*this._spacingY+this._hexSize];if(this._options.transpose&&o.reverse(),t&&(this._ctx.fillStyle=a,this._fill(o[0],o[1])),!s)return;this._ctx.fillStyle=n;let l=[].concat(s);for(let e=0;e<l.length;e++)this._ctx.fillText(l[e],o[0],Math.ceil(o[1]))}computeSize(e,t){return this._options.transpose&&(e+=t,t=e-t,e-=t),[Math.floor(e/this._spacingX)-1,Math.floor((t-2*this._hexSize)/this._spacingY+1)]}computeFontSize(e,t){this._options.transpose&&(e+=t,t=e-t,e-=t);let r=Math.min(2*e/((this._options.width+1)*Math.sqrt(3))-1,t/(2+1.5*(this._options.height-1))),i=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let s=Math.ceil(this._ctx.measureText("W").width);return this._ctx.font=i,Math.ceil(2*(r=Math.floor(r)+1)/(this._options.spacing*(1+s/100/Math.sqrt(3))))-1}_normalizedEventToPosition(e,t){let r;this._options.transpose?(e+=t,t=e-t,e-=t,r=this._ctx.canvas.width):r=this._ctx.canvas.height;let i=r/this._options.height;return q(t=Math.floor(t/i),2)?(e-=this._spacingX,e=1+2*Math.floor(e/(2*this._spacingX))):e=2*Math.floor(e/(2*this._spacingX)),[e,t]}_fill(e,t){let r=this._hexSize,i=this._options.border,s=this._ctx;s.beginPath(),this._options.transpose?(s.moveTo(e-r+i,t),s.lineTo(e-r/2+i,t+this._spacingX-i),s.lineTo(e+r/2-i,t+this._spacingX-i),s.lineTo(e+r-i,t),s.lineTo(e+r/2-i,t-this._spacingX+i),s.lineTo(e-r/2+i,t-this._spacingX+i),s.lineTo(e-r+i,t)):(s.moveTo(e,t-r+i),s.lineTo(e+this._spacingX-i,t-r/2+i),s.lineTo(e+this._spacingX-i,t+r/2-i),s.lineTo(e,t+r-i),s.lineTo(e-this._spacingX+i,t+r/2-i),s.lineTo(e-this._spacingX+i,t-r/2+i),s.lineTo(e,t-r+i)),s.fill()}_updateSize(){let e,t,r=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._hexSize=Math.floor(r.spacing*(r.fontSize+i/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,r.transpose?(e="height",t="width"):(e="width",t="height"),this._ctx.canvas[e]=Math.ceil((r.width+1)*this._spacingX),this._ctx.canvas[t]=Math.ceil((r.height-1)*this._spacingY+2*this._hexSize)}}class z extends j{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(e){super.setOptions(e),this._canvasCache={}}draw(e,t){z.cache?this._drawWithCache(e):this._drawNoCache(e,t)}_drawWithCache(e){let t,[r,i,s,n,a]=e,o=""+s+n+a;if(o in this._canvasCache)t=this._canvasCache[o];else{let e=this._options.border,r=(t=document.createElement("canvas")).getContext("2d");if(t.width=this._spacingX,t.height=this._spacingY,r.fillStyle=a,r.fillRect(e,e,t.width-e,t.height-e),s){r.fillStyle=n,r.font=this._ctx.font,r.textAlign="center",r.textBaseline="middle";let e=[].concat(s);for(let t=0;t<e.length;t++)r.fillText(e[t],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[o]=t}this._ctx.drawImage(t,r*this._spacingX,i*this._spacingY)}_drawNoCache(e,t){let[r,i,s,n,a]=e;if(t){let e=this._options.border;this._ctx.fillStyle=a,this._ctx.fillRect(r*this._spacingX+e,i*this._spacingY+e,this._spacingX-e,this._spacingY-e)}if(!s)return;this._ctx.fillStyle=n;let o=[].concat(s);for(let e=0;e<o.length;e++)this._ctx.fillText(o[e],(r+.5)*this._spacingX,Math.ceil((i+.5)*this._spacingY))}computeSize(e,t){return[Math.floor(e/this._spacingX),Math.floor(t/this._spacingY)]}computeFontSize(e,t){let r=Math.floor(e/this._options.width),i=Math.floor(t/this._options.height),s=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let n=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=s;let a=n/100*i/r;return a>1&&(i=Math.floor(i/a)),Math.floor(i/this._options.spacing)}_normalizedEventToPosition(e,t){return[Math.floor(e/this._spacingX),Math.floor(t/this._spacingY)]}_updateSize(){let e=this._options,t=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(e.spacing*t),this._spacingY=Math.ceil(e.spacing*e.fontSize),e.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=e.width*this._spacingX,this._ctx.canvas.height=e.height*this._spacingY}}z.cache=!1;class B extends j{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(e,t){let[r,i,s,n,a]=e,o=this._options.tileWidth,l=this._options.tileHeight;if(t&&(this._options.tileColorize?this._ctx.clearRect(r*o,i*l,o,l):(this._ctx.fillStyle=a,this._ctx.fillRect(r*o,i*l,o,l))),!s)return;let c=[].concat(s),d=[].concat(n),h=[].concat(a);for(let e=0;e<c.length;e++){let t=this._options.tileMap[c[e]];if(!t)throw Error(`Char "${c[e]}" not found in tileMap`);if(this._options.tileColorize){let s=this._colorCanvas,n=s.getContext("2d");n.globalCompositeOperation="source-over",n.clearRect(0,0,o,l);let a=d[e],c=h[e];n.drawImage(this._options.tileSet,t[0],t[1],o,l,0,0,o,l),"transparent"!=a&&(n.fillStyle=a,n.globalCompositeOperation="source-atop",n.fillRect(0,0,o,l)),"transparent"!=c&&(n.fillStyle=c,n.globalCompositeOperation="destination-over",n.fillRect(0,0,o,l)),this._ctx.drawImage(s,r*o,i*l,o,l)}else this._ctx.drawImage(this._options.tileSet,t[0],t[1],o,l,r*o,i*l,o,l)}}computeSize(e,t){return[Math.floor(e/this._options.tileWidth),Math.floor(t/this._options.tileHeight)]}computeFontSize(){throw Error("Tile backend does not understand font size")}_normalizedEventToPosition(e,t){return[Math.floor(e/this._options.tileWidth),Math.floor(t/this._options.tileHeight)]}_updateSize(){let e=this._options;this._ctx.canvas.width=e.width*e.tileWidth,this._ctx.canvas.height=e.height*e.tileHeight,this._colorCanvas.width=e.tileWidth,this._colorCanvas.height=e.tileHeight}}function V(e){let t,r;if(e in eo)t=eo[e];else{if("#"==e.charAt(0)){let r=(e.match(/[0-9a-f]/gi)||[]).map(e=>parseInt(e,16));if(3==r.length)t=r.map(e=>17*e);else{for(let e=0;e<3;e++)r[e+1]+=16*r[e],r.splice(e,1);t=r}}else t=(r=e.match(/rgb\(([0-9, ]+)\)/i))?r[1].split(/\s*,\s*/).map(e=>parseInt(e)):[0,0,0];eo[e]=t}return t.slice()}function $(e,...t){let r=e.slice();for(let e=0;e<3;e++)for(let i=0;i<t.length;i++)r[e]+=t[i][e];return r}function K(e,...t){for(let r=0;r<3;r++)for(let i=0;i<t.length;i++)e[r]+=t[i][r];return e}function Z(e,...t){let r=e.slice();for(let e=0;e<3;e++){for(let i=0;i<t.length;i++)r[e]*=t[i][e]/255;r[e]=Math.round(r[e])}return r}function Q(e,...t){for(let r=0;r<3;r++){for(let i=0;i<t.length;i++)e[r]*=t[i][r]/255;e[r]=Math.round(e[r])}return e}function J(e,t,r=.5){let i=e.slice();for(let s=0;s<3;s++)i[s]=Math.round(i[s]+r*(t[s]-e[s]));return i}function ee(e,t,r=.5){let i=er(e),s=er(t);for(let e=0;e<3;e++)i[e]+=r*(s[e]-i[e]);return es(i)}function et(e,t){t instanceof Array||(t=Math.round(C.getNormal(0,t)));let r=e.slice();for(let e=0;e<3;e++)r[e]+=t instanceof Array?Math.round(C.getNormal(0,t[e])):t;return r}function er(e){let t=e[0]/255,r=e[1]/255,i=e[2]/255,s=Math.max(t,r,i),n=Math.min(t,r,i),a=0,o,l=(s+n)/2;if(s==n)o=0;else{let e=s-n;switch(o=l>.5?e/(2-s-n):e/(s+n),s){case t:a=(r-i)/e+6*(r<i);break;case r:a=(i-t)/e+2;break;case i:a=(t-r)/e+4}a/=6}return[a,o,l]}function ei(e,t,r){return(r<0&&(r+=1),r>1&&(r-=1),r<1/6)?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function es(e){let t=e[2];if(0==e[1])return[t=Math.round(255*t),t,t];{let r=e[1],i=t<.5?t*(1+r):t+r-t*r,s=2*t-i;return[Math.round(255*ei(s,i,e[0]+1/3)),Math.round(255*ei(s,i,e[0])),Math.round(255*ei(s,i,e[0]-1/3))]}}function en(e){let t=e.map(e=>W(e,0,255));return`rgb(${t.join(",")})`}function ea(e){let t=e.map(e=>W(e,0,255).toString(16).padStart(2,"0"));return`#${t.join("")}`}let eo={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};e.s(["add",()=>$,"add_",()=>K,"fromString",()=>V,"hsl2rgb",()=>es,"interpolate",()=>J,"interpolateHSL",()=>ee,"lerp",0,J,"lerpHSL",0,ee,"multiply",()=>Z,"multiply_",()=>Q,"randomize",()=>et,"rgb2hsl",()=>er,"toHex",()=>ea,"toRGB",()=>en],84958);class el extends G{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(e){"string"==typeof e?alert(e):e instanceof Error&&alert(e.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(e){requestAnimationFrame(e)}getContainer(){return this._gl.canvas}setOptions(e){super.setOptions(e),this._updateSize();let t=this._options.tileSet;t&&"complete"in t&&!t.complete?t.addEventListener("load",()=>this._updateTexture(t)):this._updateTexture(t)}draw(e,t){let r=this._gl,i=this._options,[s,n,a,o,l]=e,c=r.canvas.height-(n+1)*i.tileHeight;if(r.scissor(s*i.tileWidth,c,i.tileWidth,i.tileHeight),t&&(i.tileColorize?r.clearColor(0,0,0,0):r.clearColor(...ep(l)),r.clear(r.COLOR_BUFFER_BIT)),!a)return;let d=[].concat(a),h=[].concat(l),u=[].concat(o);r.uniform2fv(this._uniforms.targetPosRel,[s,n]);for(let e=0;e<d.length;e++){let t=this._options.tileMap[d[e]];if(!t)throw Error(`Char "${d[e]}" not found in tileMap`);r.uniform1f(this._uniforms.colorize,+!!i.tileColorize),r.uniform2fv(this._uniforms.tilesetPosAbs,t),i.tileColorize&&(r.uniform4fv(this._uniforms.tint,ep(u[e])),r.uniform4fv(this._uniforms.bg,ep(h[e]))),r.drawArrays(r.TRIANGLE_STRIP,0,4)}}clear(){let e=this._gl;e.clearColor(...ep(this._options.bg)),e.scissor(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT)}computeSize(e,t){return[Math.floor(e/this._options.tileWidth),Math.floor(t/this._options.tileHeight)]}computeFontSize(){throw Error("Tile backend does not understand font size")}eventToPosition(e,t){let r=this._gl.canvas,i=r.getBoundingClientRect();return(e-=i.left,t-=i.top,e*=r.width/i.width,t*=r.height/i.height,e<0||t<0||e>=r.width||t>=r.height)?[-1,-1]:this._normalizedEventToPosition(e,t)}_initWebGL(){var e;let t,r,i=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=i;let s=function(e,t,r){let i=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw Error(e.getShaderInfoLog(i)||"");let s=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(s,r),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw Error(e.getShaderInfoLog(s)||"");let n=e.createProgram();if(e.attachShader(n,i),e.attachShader(n,s),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS))throw Error(e.getProgramInfoLog(n)||"");return n}(i,ed,eh);return i.useProgram(s),e=i,t=new Float32Array([0,0,1,0,0,1,1,1]),r=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0),ec.forEach(e=>this._uniforms[e]=i.getUniformLocation(s,e)),this._program=s,i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),i.enable(i.SCISSOR_TEST),i}_normalizedEventToPosition(e,t){return[Math.floor(e/this._options.tileWidth),Math.floor(t/this._options.tileHeight)]}_updateSize(){let e=this._gl,t=this._options,r=[t.width*t.tileWidth,t.height*t.tileHeight];e.canvas.width=r[0],e.canvas.height=r[1],e.viewport(0,0,r[0],r[1]),e.uniform2fv(this._uniforms.tileSize,[t.tileWidth,t.tileHeight]),e.uniform2fv(this._uniforms.targetSize,r)}_updateTexture(e){var t,r;let i;t=this._gl,r=e,i=t.createTexture(),t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}}let ec=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],ed=`
#version 300 es

in vec2 tilePosRel;
out vec2 tilesetPosPx;

uniform vec2 tilesetPosAbs;
uniform vec2 tileSize;
uniform vec2 targetSize;
uniform vec2 targetPosRel;

void main() {
	vec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;
	vec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;
	targetPosNdc.y *= -1.0;

	gl_Position = vec4(targetPosNdc, 0.0, 1.0);
	tilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;
}`.trim(),eh=`
#version 300 es
precision highp float;

in vec2 tilesetPosPx;
out vec4 fragColor;
uniform sampler2D image;
uniform bool colorize;
uniform vec4 bg;
uniform vec4 tint;

void main() {
	fragColor = vec4(0, 0, 0, 1);

	vec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);

	if (colorize) {
		texel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;
		fragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;
		fragColor.a = texel.a + (1.0-texel.a)*bg.a;
	} else {
		fragColor = texel;
	}
}`.trim(),eu={};function ep(e){if(!(e in eu)){let t;if("transparent"==e)t=[0,0,0,0];else if(e.indexOf("rgba")>-1){t=(e.match(/[\d.]+/g)||[]).map(Number);for(let e=0;e<3;e++)t[e]=t[e]/255}else(t=V(e).map(e=>e/255)).push(1);eu[e]=t}return eu[e]}var ef=e.i(47167);function em(e){let t=V(e);return 36*Math.floor(.0234375*t[0])+6*Math.floor(.0234375*t[1])+ +Math.floor(.0234375*t[2])+16}class eg extends G{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(e){setTimeout(e,1e3/60)}setOptions(e){super.setOptions(e);let t=[e.width,e.height],r=this.computeSize();this._offset=r.map((e,r)=>Math.floor((e-t[r])/2))}clear(){var e;ef.default.stdout.write((e=this._options.bg,`\x1b[0;48;5;${em(e)}m\x1b[2J`))}draw(e,t){let[r,i,s,n,a]=e,o=this._offset[0]+r,l=this._offset[1]+i,c=this.computeSize();if(o<0||o>=c[0]||l<0||l>=c[1])return;if((o!==this._cursor[0]||l!==this._cursor[1])&&(ef.default.stdout.write(`\x1b[${l+1};${o+1}H`),this._cursor[0]=o,this._cursor[1]=l),t&&!s&&(s=" "),!s)return;let d=`\x1b[0;38;5;${em(n)};48;5;${em(a)}m`;if(d!==this._lastColor&&(ef.default.stdout.write(d),this._lastColor=d),"	"!=s){let e=[].concat(s);ef.default.stdout.write(e[0])}this._cursor[0]++,this._cursor[0]>=c[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw Error("Terminal backend has no notion of font size")}eventToPosition(e,t){return[e,t]}computeSize(){return[ef.default.stdout.columns,ef.default.stdout.rows]}}let ey=/%([bc]){([^}]*)}/g;function eb(e,t){let r={width:0,height:1},i=ex(e,t),s=0;for(let e=0;e<i.length;e++){let t=i[e];switch(t.type){case 0:s+=t.value.length;break;case 1:r.height++,r.width=Math.max(r.width,s),s=0}}return r.width=Math.max(r.width,s),r}function ex(e,t){let r=[],i=0;e.replace(ey,function(t,s,n,a){let o=e.substring(i,a);return o.length&&r.push({type:0,value:o}),r.push({type:"c"==s?2:3,value:n.trim()}),i=a+t.length,""});let s=e.substring(i);return s.length&&r.push({type:0,value:s}),function(e,t){t||(t=1/0);let r=0,i=0,s=-1;for(;r<e.length;){let n=e[r];if(1==n.type&&(i=0,s=-1),0!=n.type){r++;continue}for(;0==i&&" "==n.value.charAt(0);)n.value=n.value.substring(1);let a=n.value.indexOf("\n");if(-1!=a){n.value=eE(e,r,a,!0);let t=n.value.split("");for(;t.length&&" "==t[t.length-1];)t.pop();n.value=t.join("")}if(!n.value.length){e.splice(r,1);continue}if(i+n.value.length>t){let a=-1;for(;;){let e=n.value.indexOf(" ",a+1);if(-1==e||i+e>t)break;a=e}if(-1!=a)n.value=eE(e,r,a,!0);else if(-1!=s){let t=e[s],i=t.value.lastIndexOf(" ");t.value=eE(e,s,i,!0),r=s}else n.value=eE(e,r,t-i,!1)}else i+=n.value.length,-1!=n.value.indexOf(" ")&&(s=r);r++}e.push({type:1});let n=null;for(let t=0;t<e.length;t++){let r=e[t];switch(r.type){case 0:n=r;break;case 1:if(n){let e=n.value.split("");for(;e.length&&" "==e[e.length-1];)e.pop();n.value=e.join("")}n=null}}return e.pop(),e}(r,t)}function eE(e,t,r,i){let s={type:0,value:e[t].value.substring(r+ +!!i)};return e.splice(t+1,0,{type:1},s),e[t].value.substring(0,r)}e.s(["TYPE_BG",0,3,"TYPE_FG",0,2,"TYPE_NEWLINE",0,1,"TYPE_TEXT",0,0,"measure",()=>eb,"tokenize",()=>ex],74283);let e_={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},ev={hex:X,rect:z,tile:B,"tile-gl":el,term:eg},ew={width:80,height:25,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};class eA{constructor(e={}){this._data={},this._dirty=!1,this._options={},e=Object.assign({},ew,e),this.setOptions(e),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(e,t,r){let i=[this._options.bg,this._options.fg];this.draw(e,t,null,null,i[r%i.length])}clear(){this._data={},this._dirty=!0}setOptions(e){if(Object.assign(this._options,e),e.width||e.height||e.fontSize||e.fontFamily||e.spacing||e.layout){if(e.layout){let t=ev[e.layout];this._backend=new t}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(e,t){return this._backend.computeSize(e,t)}computeFontSize(e,t){return this._backend.computeFontSize(e,t)}computeTileSize(e,t){return[Math.floor(e/this._options.width),Math.floor(t/this._options.height)]}eventToPosition(e){let t,r;return"touches"in e?(t=e.touches[0].clientX,r=e.touches[0].clientY):(t=e.clientX,r=e.clientY),this._backend.eventToPosition(t,r)}draw(e,t,r,i,s){i||(i=this._options.fg),s||(s=this._options.bg);let n=`${e},${t}`;this._data[n]=[e,t,r,i,s],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[n]=!0)}drawOver(e,t,r,i,s){let n=`${e},${t}`,a=this._data[n];a?(a[2]=r||a[2],a[3]=i||a[3],a[4]=s||a[4]):this.draw(e,t,r,i,s)}drawText(e,t,r,i){let s=null,n=null,a=e,o=t,l=1;i||(i=this._options.width-e);let c=ex(r,i);for(;c.length;){let t=c.shift();switch(t.type){case 0:let r=!1,i=!1,d=!1,h=!1;for(let e=0;e<t.value.length;e++){let l=t.value.charCodeAt(e),c=t.value.charAt(e);if("term"===this._options.layout){let e=l>>8;if(17===e||e>=46&&e<=159||e>=172&&e<=215||l>=43360&&l<=43391){this.draw(a+0,o,c,s,n),this.draw(a+1,o,"	",s,n),a+=2;continue}}d=l>65280&&l<65377||l>65500&&l<65512||l>65518,r=32==c.charCodeAt(0)||12288==c.charCodeAt(0),h&&!d&&!r&&a++,d&&!i&&a++,this.draw(a++,o,c,s,n),i=r,h=d}break;case 2:s=t.value||null;break;case 3:n=t.value||null;break;case 1:a=e,o++,l++}}return l}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty)for(let e in this._backend.clear(),this._data)this._draw(e,!1);else for(let e in this._dirty)this._draw(e,!0);this._dirty=!1}}_draw(e,t){let r=this._data[e];r[4]!=this._options.bg&&(t=!0),this._backend.draw(r,t)}}eA.Rect=z,eA.Hex=X,eA.Tile=B,eA.TileGL=el,eA.Term=eg,e.s(["default",()=>eA],42412);class eO{constructor(e,t={}){this._lightPasses=e,this._options=Object.assign({topology:8},t)}_getCircle(e,t,r){let i,s,n,a=[];switch(this._options.topology){case 4:s=1,n=[0,1],i=[e_[8][7],e_[8][1],e_[8][3],e_[8][5]];break;case 6:i=e_[6],s=1,n=[-1,1];break;case 8:i=e_[4],s=2,n=[-1,1];break;default:throw Error("Incorrect topology for FOV computation")}let o=e+n[0]*r,l=t+n[1]*r;for(let e=0;e<i.length;e++)for(let t=0;t<r*s;t++)a.push([o,l]),o+=i[e][0],l+=i[e][1];return a}}let eR=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]],eT=class extends eO{compute(e,t,r,i){let s,n,a,o,l,c;if(i(e,t,0,1),!this._lightPasses(e,t))return;let d=[];for(let h=1;h<=r;h++){let r=this._getCircle(e,t,h),u=r.length;for(let e=0;e<u;e++)if(s=r[e][0],n=r[e][1],o=[e?2*e-1:2*u-1,2*u],l=[2*e+1,2*u],a=!this._lightPasses(s,n),(c=this._checkVisibility(o,l,a,d))&&i(s,n,h,c),2==d.length&&0==d[0][0]&&d[1][0]==d[1][1])return}}_checkVisibility(e,t,r,i){let s;if(e[0]>t[0])return(this._checkVisibility(e,[e[1],e[1]],r,i)+this._checkVisibility([0,1],t,r,i))/2;let n=0,a=!1;for(;n<i.length;){let t=i[n],r=t[0]*e[1]-e[0]*t[1];if(r>=0){0!=r||n%2||(a=!0);break}n++}let o=i.length,l=!1;for(;o--;){let e=i[o],r=t[0]*e[1]-e[0]*t[1];if(r>=0){0==r&&o%2&&(l=!0);break}}let c=!0;if(n==o&&(a||l)||a&&l&&n+1==o&&o%2?c=!1:n>o&&n%2&&(c=!1),!c)return 0;let d=o-n+1;if(d%2)if(n%2){let e=i[n];s=(t[0]*e[1]-e[0]*t[1])/(e[1]*t[1]),r&&i.splice(n,d,t)}else{let t=i[o];s=(t[0]*e[1]-e[0]*t[1])/(e[1]*t[1]),r&&i.splice(n,d,e)}else{if(!(n%2))return r&&i.splice(n,d,e,t),1;let a=i[n],l=i[o];s=(l[0]*a[1]-a[0]*l[1])/(a[1]*l[1]),r&&i.splice(n,d)}return s/((t[0]*e[1]-e[0]*t[1])/(e[1]*t[1]))}};e.i(17628),e.i(84958),e.i(74283),e.s([],55409);var eS=e.i(77757),eI=((t={}).WALL="#",t.FLOOR=".",t);let eM=Array(eS.GRID_WIDTH*eS.GRID_HEIGHT).fill("#");function eN(){eM.fill("#")}function eD(e,t){return e>=0&&e<eS.GRID_WIDTH&&t>=0&&t<eS.GRID_HEIGHT}function eL(e,t,r){eD(e,t)&&(eM[t*eS.GRID_WIDTH+e]=r)}function eH(e,t){return eD(e,t)?eM[t*eS.GRID_WIDTH+e]:null}e.s(["TileType",()=>eI,"getTile",()=>eH,"isInBounds",()=>eD,"mapData",0,eM,"resetMap",()=>eN,"setTile",()=>eL],69268);class eP{visibleCells=new Set;exploredCells=new Set;rotFOV;constructor(){this.rotFOV=new eT((e,t)=>eH(e,t)===eI.FLOOR)}compute(e,t,r){this.visibleCells.clear(),this.rotFOV.compute(e,t,r,(e,t)=>{let r=t*eS.GRID_WIDTH+e;this.visibleCells.add(r),this.exploredCells.add(r)})}reset(){this.visibleCells.clear(),this.exploredCells.clear()}}let ek=new eP;e.s(["fovSystem",0,ek],34147);var eF=e.i(11742);function eC(e){if(!e.fighter)return;let t=e.fighter.baseAttack||0,r=e.fighter.baseDefense||0,i=e.id||"player";for(let e of Array.from(k.with("equipped","equippable")).filter(e=>e.equipped.ownerId===i))e.equippable.bonuses.attack&&(t+=e.equippable.bonuses.attack),e.equippable.bonuses.defense&&(r+=e.equippable.bonuses.defense);e.fighter.attack=t,e.fighter.defense=r,eF.useGameStore.getState().setStats({attack:t,defense:r})}function eG(e){if(!e.equippable)return{success:!1,message:"Item is not equippable"};let t=k.with("player","fighter"),r=null;for(let e of t){r=e;break}if(!r)return{success:!1,message:"Player not found"};let i=r.id||"player",s=e.equippable.slot;for(let e of Array.from(k.with("equipped","equippable")).filter(e=>e.equipped.ownerId===i&&e.equippable.slot===s))ej(e);k.addComponent(e,"equipped",{ownerId:i});let n=e.name||"Unknown item";return eF.useGameStore.getState().addLog(`You equipped ${n}.`,"green"),eC(r),{success:!0,message:`Equipped ${n}`}}function ej(e){if(!e.equipped)return{success:!1,message:"Item is not equipped"};k.removeComponent(e,"equipped");let t=k.with("player","fighter"),r=null;for(let e of t){r=e;break}r&&eC(r);let i=e.name||"Unknown item";return eF.useGameStore.getState().addLog(`You unequipped ${i}.`,"yellow"),{success:!0,message:`Unequipped ${i}`}}function eq(){let e=k.with("player"),t=null;for(let r of e){t=r.id||"player";break}return t?Array.from(k.with("equipped","equippable")).filter(e=>e.equipped.ownerId===t):[]}e.s(["equipItem",()=>eG,"getPlayerEquipment",()=>eq,"recalculatePlayerStats",()=>eC,"unequipItem",()=>ej],36352);let eW=[],eU=0,eY=null,eX=null,ez=null,eB=0,eV="";function e$(e){eY=e}function eK(e){ez=e}function eZ(e){let t=["*","+"],r=["#fbbf24","#def50bff","#93fc4dff"];eV="LEVEL UP",eB=performance.now()+3e3;for(let i=0;i<28;i++){let s=2*Math.PI*i/28,n=2+1.5*Math.random();eW.push({x:e.x+(.4*Math.random()-.2),y:e.y+(.4*Math.random()-.2),vx:Math.cos(s)*n*.2,vy:-Math.abs(Math.sin(s)*n*.4)-.4,char:t[i%t.length],color:r[i%r.length],lifetimeMs:1500+500*Math.random()})}}function eQ(e){for(let t of eW){let r=Math.round(t.x),i=Math.round(t.y);r<0||i<0||r>=eS.GRID_WIDTH||i>=eS.GRID_HEIGHT||e.draw(r,i,t.char,t.color,eS.BG_COLOR)}if(eB>performance.now()&&eV){let t=Math.max(0,Math.floor((eS.GRID_WIDTH-eV.length)/2)),r=Math.floor(eS.GRID_HEIGHT/2)-1,i=Math.min(eS.GRID_WIDTH,eV.length+4),s=Math.max(0,Math.floor((eS.GRID_WIDTH-i)/2));e.drawText(s,r,`%b{#111827} ${" ".repeat(Math.max(0,i-2))} `),e.drawText(t,r,`%c{#facc15}%b{#111827}${eV}`)}}function eJ(e=700,t){if(!eY)return;let r=t??ez;if(!r)return;null!==eX&&(cancelAnimationFrame(eX),eX=null);let i=performance.now(),s=()=>{let t=performance.now();0===eU&&(eU=t);let n=Math.min(50,t-eU);eU=t;for(let e=eW.length-1;e>=0;e-=1){let t=eW[e];t.x+=t.vx*(n/1e3),t.y+=t.vy*(n/1e3),t.lifetimeMs-=n,t.lifetimeMs<=0&&eW.splice(e,1)}r(),eX=t-i<e?requestAnimationFrame(s):null};eX=requestAnimationFrame(s)}function e0(e){return Math.floor(100*Math.pow(e,1.5))}function e1(e){e.experience&&eF.useGameStore.getState().setExperience({level:e.experience.level,currentXp:e.experience.currentXp,nextLevelXp:e.experience.nextLevelXp,totalXp:e.experience.totalXp})}function e2(e,t){if(!e.experience||t<=0)return;let r=Math.floor(t*(.5*eF.useGameStore.getState().currentFloor+1));for(e.experience.currentXp+=r,e.experience.totalXp+=r,eF.useGameStore.getState().addLog(`You gain ${r} XP.`,"yellow");e.experience.currentXp>=e.experience.nextLevelXp;)!function(e){if(e.experience){if(e.experience.level+=1,e.experience.currentXp-=e.experience.nextLevelXp,e.experience.nextLevelXp=e0(e.experience.level),e.fighter){let t=e.fighter.baseAttack??e.fighter.attack,r=e.fighter.baseDefense??e.fighter.defense;e.fighter.maxHp+=10,e.fighter.hp=Math.min(e.fighter.maxHp,e.fighter.hp+10),e.fighter.baseAttack=t+1,e.fighter.baseDefense=r+ +(e.experience.level%2==0),eC(e),eF.useGameStore.getState().setHp(e.fighter.hp),eF.useGameStore.getState().setMaxHp(e.fighter.maxHp)}e.position&&(eZ(e.position),eJ(3e3)),eF.useGameStore.getState().addLog(`Level up! You reached level ${e.experience.level}.`,"purple")}}(e);e1(e)}function e5(e){e.experience={level:1,currentXp:0,nextLevelXp:e0(1),totalXp:0},e1(e)}e.s(["renderParticles",()=>eQ,"setParticleDisplay",()=>e$,"setParticleRenderer",()=>eK,"spawnLevelUpParticles",()=>eZ,"startParticleAnimation",()=>eJ],15959),e.s(["addExperience",()=>e2,"initializeExperience",()=>e5],90001);class e4{grid=new Map;getKey(e,t){return t*eS.GRID_WIDTH+e}add(e){if(!e.position)return;let t=this.getKey(e.position.x,e.position.y);this.grid.has(t)||this.grid.set(t,new Set),this.grid.get(t).add(e)}remove(e){if(!e.position){for(let[t,r]of this.grid.entries())if(r.has(e)){r.delete(e),0===r.size&&this.grid.delete(t);break}return}let t=this.getKey(e.position.x,e.position.y),r=this.grid.get(t);r&&(r.delete(e),0===r.size&&this.grid.delete(t))}update(e,t,r){if(!e.position)return;let i=this.getKey(t,r),s=this.grid.get(i);s&&(s.delete(e),0===s.size&&this.grid.delete(i)),this.add(e)}getAt(e,t){let r=this.getKey(e,t),i=this.grid.get(r);return i?Array.from(i):[]}getFirstAt(e,t,r){for(let i of this.getAt(e,t))if(i!==r)return i;return null}hasEntityAt(e,t){let r=this.getKey(e,t),i=this.grid.get(r);return!!i&&i.size>0}clear(){this.grid.clear()}rebuild(e){for(let t of(this.clear(),e))t.position&&this.add(t)}}let e3=new e4;e.s(["spatialGrid",0,e3],40253);let e8="maxime_roguelike_save_v1";function e6(){try{let e=eF.useGameStore.getState(),t={entities:k.entities,map:[...eM],explored:Array.from(ek.exploredCells),stats:{hp:e.hp,maxHp:e.maxHp,attack:e.attack,defense:e.defense,turn:e.currentTurn,floor:e.currentFloor,level:e.level,currentXp:e.currentXp,nextLevelXp:e.nextLevelXp,totalXp:e.totalXp}};return localStorage.setItem(e8,JSON.stringify(t)),e.addLog("Game saved successfully.","yellow"),!0}catch(e){return console.error("Failed to save game:",e),eF.useGameStore.getState().addLog("Failed to save game!","red"),!1}}function e7(){try{let e=localStorage.getItem(e8);if(!e)return!1;let t=JSON.parse(e);if(!function(e){if(!e||"object"!=typeof e||!Array.isArray(e.entities)||!Array.isArray(e.map)||e.map.some(e=>"#"!==e&&"."!==e)||!Array.isArray(e.explored)||e.explored.some(e=>"number"!=typeof e)||!e.stats||"object"!=typeof e.stats)return!1;let t=e.stats;for(let e of["hp","maxHp","attack","defense","turn","floor","level","currentXp","nextLevelXp","totalXp"])if("number"!=typeof t[e])return!1;return!(t.hp<0)&&!(t.maxHp<1)&&!(t.attack<0)&&!(t.defense<0)&&!(t.turn<0)&&!(t.floor<1)&&!(t.level<1)&&!(t.currentXp<0)&&!(t.nextLevelXp<1)&&!(t.totalXp<0)&&!0}(t))return console.error("Save data validation failed"),eF.useGameStore.getState().addLog("Save file is corrupted or invalid!","red"),!1;for(let e of(k.clear(),t.entities))k.add(e);for(let e=0;e<t.map.length;e++)eM[e]=t.map[e];for(let e of(ek.reset(),t.explored))ek.exploredCells.add(e);e3.rebuild(k.entities);let r=eF.useGameStore.getState();r.setHp(t.stats.hp),r.setMaxHp(t.stats.maxHp),r.setStats({attack:t.stats.attack,defense:t.stats.defense}),t.stats.floor&&r.setFloor(t.stats.floor),"number"==typeof t.stats.level&&r.setExperience({level:t.stats.level,currentXp:t.stats.currentXp??0,nextLevelXp:t.stats.nextLevelXp??100,totalXp:t.stats.totalXp??0});let i=k.with("player","position").first;return i&&i.position&&(i.experience||("number"==typeof t.stats.level?i.experience={level:t.stats.level,currentXp:t.stats.currentXp??0,nextLevelXp:t.stats.nextLevelXp??100,totalXp:t.stats.totalXp??0}:e5(i)),ek.compute(i.position.x,i.position.y,8),eC(i),i.experience?"number"!=typeof t.stats.level&&r.setExperience({level:i.experience.level,currentXp:i.experience.currentXp,nextLevelXp:i.experience.nextLevelXp,totalXp:i.experience.totalXp}):"number"!=typeof t.stats.level&&r.setExperience({level:1,currentXp:0,nextLevelXp:100,totalXp:0})),r.addLog("Game loaded successfully.","yellow"),!0}catch(e){return console.error("Failed to load game:",e),eF.useGameStore.getState().addLog("Failed to load game - save file might be corrupted.","red"),!1}}function e9(){localStorage.removeItem(e8)}function te(){return null!==localStorage.getItem(e8)}e.s(["deleteSave",()=>e9,"hasSave",()=>te,"loadGame",()=>e7,"saveGame",()=>e6],15089)},35581,e=>{"use strict";var t=e.i(43476),r=e.i(71645);e.i(55409);var i=e.i(42412),i=i,s=e.i(7670),n=e.i(77757);class a{cache=new Map;currentSize=0;options;constructor(e){this.options=e}get(e){let t=this.cache.get(e);return t?(t.lastAccess=Date.now(),t.image):null}has(e){return this.cache.has(e)}set(e,t){for(;this.currentSize+1024>this.options.maxSize||this.cache.size>=this.options.maxEntries;)this.evictLRU();this.cache.set(e,{image:t,lastAccess:Date.now(),size:1024}),this.currentSize+=1024}evictLRU(){let e=null,t=1/0;for(let[r,i]of this.cache)i.lastAccess<t&&(t=i.lastAccess,e=r);if(e){let t=this.cache.get(e);this.currentSize-=t.size,this.cache.delete(e)}}clearUnused(e){for(let[t,r]of this.cache)e.has(t)||(this.currentSize-=r.size,this.cache.delete(t))}clear(){this.cache.clear(),this.currentSize=0}getStats(){return{entries:this.cache.size,size:this.currentSize,maxSize:this.options.maxSize,usage:this.currentSize/this.options.maxSize*100}}}e.i(47167);let o="/rogue-like-dungeon-adventure",l={entity:"/assets/sprites/default/default-entity.png",item:"/assets/sprites/default/default-item.png",tile:"/assets/sprites/default/default-tile.png"};class c{cache;loadingPromises=new Map;defaultImages=new Map;constructor(e){this.cache=e}async loadImage(e){let t=o&&e.startsWith(o)?e:`${o}${e}`,r=this.cache.get(t);if(r)return r;if(this.loadingPromises.has(t))return this.loadingPromises.get(t);let i=new Promise((e,r)=>{let i=new Image;i.onload=()=>{this.cache.set(t,i),this.loadingPromises.delete(t),e(i)},i.onerror=()=>{this.loadingPromises.delete(t),r(Error(`Failed to load image: ${t}`))},i.src=t});return this.loadingPromises.set(t,i),i}async loadWithFallback(e,t){if(!e)return this.getDefaultImage(t);try{return await this.loadImage(e)}catch(r){return console.warn(`Failed to load ${e}, using default ${t} image`),this.getDefaultImage(t)}}getDefaultImage(e){return this.defaultImages.get(e)||null}async preloadDefaults(){let e=Object.entries(l).map(async([e,t])=>{try{let r=await this.loadImage(t);this.defaultImages.set(e,r)}catch(t){console.error(`Failed to load default ${e} image:`,t)}});await Promise.all(e)}async loadBatch(e){let t=e.map(e=>this.loadImage(e).catch(t=>(console.warn(`Failed to preload ${e}:`,t),null)));await Promise.all(t)}isLoaded(e){return this.cache.has(e)}isLoading(e){return this.loadingPromises.has(e)}}class d{loader;constructor(e){this.loader=e}async loadDefaults(){return this.loader.preloadDefaults()}async loadBatch(e){return this.loader.loadBatch(e)}async preloadVisible(e){let t=[];for(let r of[...e].sort((e,t)=>{let r=e.player?3:e.monster?2:1;return(t.player?3:t.monster?2:1)-r})){let e=r.renderable?.sprite?.path;e&&!this.loader.isLoaded(e)&&t.push(e)}for(let e=0;e<t.length;e+=10){let r=t.slice(e,e+10);await this.loadBatch(r)}}async preloadLevel(e){let t=["/assets/sprites/tiles/floor.png","/assets/sprites/tiles/wall.png","/assets/sprites/tiles/door.png"];for(let r of e){let e=r.renderable?.sprite?.path;e&&!t.includes(e)&&t.push(e)}await this.loadBatch(t)}async preloadByType(e,t){let r=t.filter(e=>!this.loader.isLoaded(e));await this.loadBatch(r)}}let h=new class{cache;loader;preloader;constructor(){this.cache=new a({maxSize:2097152,maxEntries:100}),this.loader=new c(this.cache),this.preloader=new d(this.loader)}async getImage(e,t){return this.loader.loadWithFallback(e,t)}async preloadDefaults(){return this.preloader.loadDefaults()}async preloadBatch(e){return this.preloader.loadBatch(e)}async preloadVisible(e){return this.preloader.preloadVisible(e)}async preloadLevel(e){return this.preloader.preloadLevel(e)}clearUnused(e){this.cache.clearUnused(e)}clearCache(){this.cache.clear()}getCacheStats(){return this.cache.getStats()}isLoaded(e){return this.loader.isLoaded(e)}isLoading(e){return this.loader.isLoading(e)}};var u=e.i(47830),p=e.i(69268),f=e.i(34147),m=e.i(11742),g=e.i(15959);let y=async(e,t)=>{for(let r=0;r<n.GRID_HEIGHT;r++)for(let i=0;i<n.GRID_WIDTH;i++){let s=r*n.GRID_WIDTH+i,a=f.fovSystem.visibleCells.has(s),o=f.fovSystem.exploredCells.has(s);if(a||o){let o=p.mapData[s],l=o===p.TileType.WALL?"/assets/sprites/tiles/wall.png":"/assets/sprites/tiles/floor.png",c=await h.getImage(l,"tile");if(c)e.globalAlpha=a?1:.4,e.drawImage(c,i*n.SPRITE_SIZE,r*n.SPRITE_SIZE,n.SPRITE_SIZE,n.SPRITE_SIZE),e.globalAlpha=1;else if(n.FALLBACK_TO_ASCII){let e=o===p.TileType.WALL?"#":".",s=a?o===p.TileType.WALL?"#888":"#666":o===p.TileType.WALL?"#333":"#222";t.draw(i,r,e,s,n.BG_COLOR)}}}},b=async(e,t)=>{t.fillStyle=n.BG_COLOR,t.fillRect(0,0,n.GRID_WIDTH*n.SPRITE_SIZE,n.GRID_HEIGHT*n.SPRITE_SIZE),await y(t,e),await x(t,e),E(t)},x=async(e,t)=>{let r=Array.from(u.world.with("position","renderable"));for(let i of(r.sort((e,t)=>(e.player?2:+!!e.monster)-(t.player?2:+!!t.monster)),r)){if(!i.position||!i.renderable||i.dead)continue;let{x:r,y:s}=i.position,a=s*n.GRID_WIDTH+r;if(f.fovSystem.visibleCells.has(a)){let{sprite:a,char:o,color:l,bg:c}=i.renderable,d=a?.path;if(d||i.item,d||i.item){let u=i.item?"item":"entity",p=d||`__default_${u}__`,f=await h.getImage(p,u);if(f){let t=a?.offset?.x||0,i=a?.offset?.y||0;e.drawImage(f,r*n.SPRITE_SIZE+t,s*n.SPRITE_SIZE+i,n.SPRITE_SIZE,n.SPRITE_SIZE)}else n.FALLBACK_TO_ASCII&&t.draw(r,s,o,l,c||n.BG_COLOR)}else n.FALLBACK_TO_ASCII&&t.draw(r,s,o,l,c||n.BG_COLOR)}}},E=e=>{"GAME_OVER"===m.useGameStore.getState().gameStatus&&(e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,n.GRID_WIDTH*n.SPRITE_SIZE,n.GRID_HEIGHT*n.SPRITE_SIZE),e.fillStyle="#ff0000",e.font="bold 32px monospace",e.textAlign="center",e.textBaseline="middle",e.fillText("YOU DIED",n.GRID_WIDTH*n.SPRITE_SIZE/2,n.GRID_HEIGHT*n.SPRITE_SIZE/2),e.textAlign="left",e.textBaseline="alphabetic")},_=(e,t)=>{"sprites"===m.useGameStore.getState().renderMode&&t?b(e,t):(e=>{e.clear();for(let t=0;t<n.GRID_HEIGHT;t++)for(let r=0;r<n.GRID_WIDTH;r++){let i=t*n.GRID_WIDTH+r,s=f.fovSystem.visibleCells.has(i),a=f.fovSystem.exploredCells.has(i);if(s){let s=p.mapData[i],a=s===p.TileType.WALL?"#":".",o=s===p.TileType.WALL?"#888":"#666";e.draw(r,t,a,o,n.BG_COLOR)}else if(a){let s=p.mapData[i],a=s===p.TileType.WALL?"#":".",o=s===p.TileType.WALL?"#333":"#222";e.draw(r,t,a,o,n.BG_COLOR)}}let t=Array.from(u.world.with("position","renderable"));for(let r of(t.sort((e,t)=>(e.player?2:+!!e.monster)-(t.player?2:+!!t.monster)),t)){if(!r.position||!r.renderable||r.dead)continue;let{x:t,y:i}=r.position,s=i*n.GRID_WIDTH+t;if(f.fovSystem.visibleCells.has(s)){let{char:s,color:a,bg:o}=r.renderable;e.draw(t,i,s,a,o||n.BG_COLOR)}}if((0,g.renderParticles)(e),"GAME_OVER"===m.useGameStore.getState().gameStatus){let t="YOU DIED",r=Math.max(0,Math.floor((n.GRID_WIDTH-t.length)/2)),i=Math.floor(n.GRID_HEIGHT/2);e.drawText(r,i,`%c{#f00}%b{${n.BG_COLOR}}${t}`)}})(e)};class v{x;y;w;h;left=null;right=null;room=null;constructor(e,t,r,i){this.x=e,this.y=t,this.w=r,this.h=i}}class w{minRoomSize=6;maxIterations=4;generate(){let e=0;for(;e<10;){(0,p.resetMap)(),e>0&&(0,p.resetMap)();let t=new v(0,0,n.GRID_WIDTH,n.GRID_HEIGHT);this.split(t,0),this.createRooms(t);let r=this.findFirstRoom(t);if(!r){e++;continue}let i={x:Math.floor((r.x1+r.x2)/2),y:Math.floor((r.y1+r.y2)/2)},s=[];if(this.collectRooms(t,s),this.verifyConnectivity(i,s))return{playerStart:i,rooms:s};e++}throw Error("Failed to generate connected dungeon after 10 attempts")}verifyConnectivity(e,t){let r=new Set,i=[e.y*n.GRID_WIDTH+e.x];r.add(e.y*n.GRID_WIDTH+e.x);let s=t.map(e=>({x:Math.floor(e.x+e.w/2),y:Math.floor(e.y+e.h/2)})),a=new Set;for(;i.length>0;){let e=i.pop();a.add(e);let t=e%n.GRID_WIDTH,s=Math.floor(e/n.GRID_WIDTH);for(let e of[{x:t+1,y:s},{x:t-1,y:s},{x:t,y:s+1},{x:t,y:s-1}])if(e.x>=0&&e.x<n.GRID_WIDTH&&e.y>=0&&e.y<n.GRID_HEIGHT){let t=e.y*n.GRID_WIDTH+e.x;r.has(t)||(0,p.getTile)(e.x,e.y)===p.TileType.FLOOR&&(r.add(t),i.push(t))}}for(let e of s){let t=e.y*n.GRID_WIDTH+e.x;if(!a.has(t))return!1}return!0}collectRooms(e,t){e.room&&t.push({x:e.room.x1,y:e.room.y1,w:e.room.x2-e.room.x1,h:e.room.y2-e.room.y1}),e.left&&this.collectRooms(e.left,t),e.right&&this.collectRooms(e.right,t)}split(e,t){if(t>=this.maxIterations)return;let r=Math.random()>.5;e.w>1.25*e.h?r=!1:e.h>1.25*e.w&&(r=!0);let i=(r?e.h:e.w)-this.minRoomSize;if(i<=this.minRoomSize)return;let s=Math.floor(Math.random()*(i-this.minRoomSize)+this.minRoomSize);r?(e.left=new v(e.x,e.y,e.w,s),e.right=new v(e.x,e.y+s,e.w,e.h-s)):(e.left=new v(e.x,e.y,s,e.h),e.right=new v(e.x+s,e.y,e.w-s,e.h)),this.split(e.left,t+1),this.split(e.right,t+1)}createRooms(e){if(e.left||e.right)e.left&&this.createRooms(e.left),e.right&&this.createRooms(e.right),e.left&&e.right&&this.digTunnel(e.left,e.right);else{let t=Math.floor(Math.random()*(e.w-4))+4,r=Math.floor(Math.random()*(e.h-4))+4,i=e.x+Math.floor(Math.random()*(e.w-t-1))+1,s=e.y+Math.floor(Math.random()*(e.h-r-1))+1;e.room={x1:i,y1:s,x2:i+t,y2:s+r};for(let e=s;e<s+r;e++)for(let r=i;r<i+t;r++)(0,p.setTile)(r,e,p.TileType.FLOOR)}}digTunnel(e,t){let r=this.getCenter(e),i=this.getCenter(t);for(let e=Math.min(r.x,i.x);e<=Math.max(r.x,i.x);e++)(0,p.setTile)(e,r.y,p.TileType.FLOOR);for(let e=Math.min(r.y,i.y);e<=Math.max(r.y,i.y);e++)(0,p.setTile)(i.x,e,p.TileType.FLOOR)}getCenter(e){return e.room?{x:Math.floor((e.room.x1+e.room.x2)/2),y:Math.floor((e.room.y1+e.room.y2)/2)}:e.left&&e.right?.5>Math.random()?this.getCenter(e.left):this.getCenter(e.right):e.left?this.getCenter(e.left):e.right?this.getCenter(e.right):{x:Math.floor(e.x+e.w/2),y:Math.floor(e.y+e.h/2)}}findFirstRoom(e){return e.room?e.room:e.left?this.findFirstRoom(e.left):null}}let A={ArrowUp:{dx:0,dy:-1},ArrowDown:{dx:0,dy:1},ArrowLeft:{dx:-1,dy:0},ArrowRight:{dx:1,dy:0},h:{dx:-1,dy:0},j:{dx:0,dy:1},k:{dx:0,dy:-1},l:{dx:1,dy:0},y:{dx:-1,dy:-1},u:{dx:1,dy:-1},b:{dx:-1,dy:1},n:{dx:1,dy:1},1:{dx:-1,dy:1},2:{dx:0,dy:1},3:{dx:1,dy:1},4:{dx:-1,dy:0},6:{dx:1,dy:0},7:{dx:-1,dy:-1},8:{dx:0,dy:-1},9:{dx:1,dy:-1},End:{dx:-1,dy:1},Home:{dx:-1,dy:-1},PageDown:{dx:1,dy:1},PageUp:{dx:1,dy:-1}};var O=e.i(40253);let R=[],T=0;function S(e){R=[...R,e].slice(-50),T+=1}var I=e.i(15089),M=e.i(90001);function N(e){return e.name?e.name:e.player?"Player":e.monster?"Monster":"Entity"}function D(e,t){if(!e.fighter||!t.fighter||t.dead)return;let r=Math.max(0,e.fighter.attack-t.fighter.defense),i=N(e),s=N(t);(r>0?(t.fighter.hp-=r,S(`${i} hit ${s} for ${r}.`),t.player?(m.useGameStore.getState().setHp(t.fighter.hp),m.useGameStore.getState().triggerHit(),m.useGameStore.getState().addLog(`${i} hit you for ${r} damage!`,"red")):m.useGameStore.getState().addLog(`You hit ${s} for ${r} damage!`,"yellow")):(S(`${i} attacks ${s} but does no damage.`),m.useGameStore.getState().addLog(`${i} attacks ${s} but does no damage.`,"gray")),t.fighter.hp<=0)&&(S(`${s} dies!`),t.player?(m.useGameStore.getState().setHp(0),m.useGameStore.getState().addLog("You died!","purple"),m.useGameStore.getState().setGameStatus("GAME_OVER"),(0,I.deleteSave)()):(e.experience&&"number"==typeof t.xpValue&&(0,M.addExperience)(e,t.xpValue),m.useGameStore.getState().addLog(`${s} dies!`,"green")),u.world.addComponent(t,"dead",!0),O.spatialGrid.remove(t),u.world.remove(t))}function L(e){return 0===e?0:e>0?1:-1}function H(){let e=u.world.with("player","position","fighter"),t=null;for(let r of e){t=r;break}if(t&&t.position&&t.fighter)for(let e of u.world.with("monster","position","fighter")){var r,i;if(e.dead||!e.ai||"PASSIVE"===e.ai.type||!e.position)continue;let s=(r=e.position,i=t.position,Math.max(Math.abs(r.x-i.x),Math.abs(r.y-i.y)));if(s>8)continue;if(s<=1){D(e,t);continue}let n=L(t.position.x-e.position.x),a=L(t.position.y-e.position.y);!function(e,t,r){if(!e.position)return;let i=e.position.x,s=e.position.y,n=i+t,a=s+r;if(!(0,p.isInBounds)(n,a))return;let o=(0,p.getTile)(n,a);if(null===o||o===p.TileType.WALL)return;let l=O.spatialGrid.getFirstAt(n,a,e);if(!l){e.position.x=n,e.position.y=a,O.spatialGrid.update(e,i,s);return}l.player&&l.fighter&&e.fighter&&D(e,l)}(e,n,a)}}let P={rat:{id:"rat",name:"Rat Gant",char:"r",color:"#e2a90eff",sprite:{path:"/assets/sprites/entities/monsters/rat.png"},health:{min:10,max:15},attack:{min:8,max:12},defense:2,aiType:"AGGRESSIVE",xpValue:15,spawnWeight:10},slime_green:{id:"slime_green",name:"Slime Acide",char:"s",color:"#00FF00",sprite:{path:"/assets/sprites/entities/monsters/slime.png"},health:{min:15,max:20},attack:{min:13,max:18},defense:3,aiType:"AGGRESSIVE",xpValue:20,spawnWeight:5},tiger_white:{id:"tiger_white",name:"Tigre Blanc",char:"T",color:"#f5fff5ff",sprite:{path:"/assets/sprites/entities/monsters/tiger.png"},health:{min:30,max:40},attack:{min:20,max:35},defense:5,aiType:"AGGRESSIVE",xpValue:50,spawnWeight:1}};function k(e,t){return Math.floor(Math.random()*(t-e+1))+e}function F(e){return{hp:k(e.health.min,e.health.max),attack:k(e.attack.min,e.attack.max)}}function C(){for(let e of u.world.with("player"))return e.inventory?.maxSlots??n.MAX_INVENTORY_SIZE;return n.MAX_INVENTORY_SIZE}function G(){let e=u.world.with("player"),t=null;for(let r of e){t=r.id||"player";break}return t?Array.from(u.world).filter(e=>e.item).filter(e=>e.inInventory).filter(e=>e.inInventory?.ownerId===t):[]}var j=e.i(36352);let q=({isOpen:e,onClose:i,onRerender:a})=>{let[o,l]=(0,r.useState)([]),[c,d]=(0,r.useState)(()=>C()),[h,p]=(0,r.useState)(0),[f,g]=(0,r.useState)("ALL"),[y,b]=(0,r.useState)(null),x=e=>`${e>=0?"+":"-"}${Math.abs(e)}`;(0,r.useEffect)(()=>{e&&(l(G()),d(C()),p(0))},[e]);let E=o.filter(e=>"ALL"===f||("CONSUMABLES"===f?e.item?.type==="POTION"||e.item?.type==="FOOD"||e.item?.type==="SCROLL":"EQUIPMENT"===f?e.item?.type==="WEAPON"||e.item?.type==="ARMOR":"MISC"!==f||!["POTION","FOOD","SCROLL","WEAPON","ARMOR"].includes(e.item?.type||"")));(0,r.useEffect)(()=>{h>=E.length&&E.length>0&&p(E.length-1)},[E.length,h]);let _=e=>{if(function(e){if(!e.consumable)return{success:!1,message:"Item is not consumable"};let t=u.world.with("player","fighter"),r=null;for(let e of t){r=e;break}if(!r||!r.fighter)return{success:!1,message:"Player not found"};let i=e.consumable.effect,s=e.consumable.amount,a=e.name||"Unknown item";switch(i){case"HEAL_HP":{let e=r.fighter.hp;s>=9999?r.fighter.hp=r.fighter.maxHp:r.fighter.hp=Math.min(r.fighter.maxHp,r.fighter.hp+s);let t=r.fighter.hp-e;m.useGameStore.getState().setHp(r.fighter.hp),m.useGameStore.getState().addLog(`You use ${a} and restore ${t} HP.`,"green");break}case"EXPAND_INVENTORY":r.inventory||(r.inventory={maxSlots:n.MAX_INVENTORY_SIZE,currentSlots:0}),r.inventory.maxSlots+=s,m.useGameStore.getState().addLog(`You use ${a}. Inventory capacity increased to ${r.inventory.maxSlots}!`,"cyan");break;case"BOOST_ATK":r.fighter.attack+=s,void 0!==r.fighter.baseAttack&&(r.fighter.baseAttack+=s),m.useGameStore.getState().setStats({attack:r.fighter.attack,defense:r.fighter.defense}),m.useGameStore.getState().addLog(`You use ${a}. Your attack increases by ${s}!`,"green");break;case"BOOST_DEF":r.fighter.defense+=s,void 0!==r.fighter.baseDefense&&(r.fighter.baseDefense+=s),m.useGameStore.getState().setStats({attack:r.fighter.attack,defense:r.fighter.defense}),m.useGameStore.getState().addLog(`You use ${a}. Your defense increases by ${s}!`,"green");break;case"CURE_POISON":m.useGameStore.getState().addLog(`You use ${a}. Poison cure not yet implemented.`,"yellow");break;default:return{success:!1,message:"Unknown effect"}}return O.spatialGrid.remove(e),u.world.remove(e),{success:!0,message:`Used ${a}`}}(e).success){let e=G();l(e),d(C()),h>=e.length&&p(Math.max(0,e.length-1)),a()}},v=e=>{let t=(0,j.equipItem)(e);t.success?(l(G()),a()):(b(t.message),setTimeout(()=>b(null),3e3))},w=e=>{let t=(0,j.unequipItem)(e);t.success?(l(G()),a()):(b(t.message),setTimeout(()=>b(null),3e3))},A=e=>{let t=function(e){let t=u.world.with("player","position"),r=null;for(let e of t){r=e;break}if(!r||!r.position)return{success:!1,message:"Player not found"};let i=e.name||"Unknown item";return O.spatialGrid.getAt(r.position.x,r.position.y).filter(e=>e.item&&e!==r).length>0?{success:!1,message:"There is already an item here! Move to drop."}:(e.equipped&&(0,j.unequipItem)(e),u.world.removeComponent(e,"inInventory"),u.world.addComponent(e,"position",{x:r.position.x,y:r.position.y}),O.spatialGrid.add(e),m.useGameStore.getState().addLog(`You dropped ${i}.`,"gray"),{success:!0,message:`Dropped ${i}`})}(e);if(t.success){let e=G();l(e),h>=e.length&&p(Math.max(0,e.length-1)),b(null),a()}else b(t.message),setTimeout(()=>b(null),3e3)};if((0,r.useEffect)(()=>{if(!e)return;let t=e=>{if("Escape"===e.key||"i"===e.key.toLowerCase()){e.preventDefault(),i();return}if("ArrowUp"===e.key)e.preventDefault(),p(e=>Math.max(0,e-1));else if("ArrowDown"===e.key)e.preventDefault(),p(e=>Math.min(E.length-1,e+1));else if("ArrowLeft"===e.key){e.preventDefault();let t=["ALL","CONSUMABLES","EQUIPMENT","MISC"],r=t.indexOf(f),i=r>0?r-1:t.length-1;g(t[i])}else if("ArrowRight"===e.key){e.preventDefault();let t=["ALL","CONSUMABLES","EQUIPMENT","MISC"],r=t.indexOf(f),i=r<t.length-1?r+1:0;g(t[i])}else"Home"===e.key?(e.preventDefault(),p(0)):"End"===e.key?(e.preventDefault(),p(Math.max(0,E.length-1))):"PageUp"===e.key?(e.preventDefault(),p(e=>Math.max(0,e-10))):"PageDown"===e.key?(e.preventDefault(),p(e=>Math.min(E.length-1,e+10))):"Enter"===e.key||" "===e.key||"u"===e.key.toLowerCase()?(e.preventDefault(),E[h]&&_(E[h])):"e"===e.key.toLowerCase()?(e.preventDefault(),E[h]&&v(E[h])):"r"===e.key.toLowerCase()?(e.preventDefault(),E[h]&&w(E[h])):"1"===e.key?(e.preventDefault(),g("ALL")):"2"===e.key?(e.preventDefault(),g("CONSUMABLES")):"3"===e.key?(e.preventDefault(),g("EQUIPMENT")):"4"===e.key?(e.preventDefault(),g("MISC")):"d"===e.key.toLowerCase()&&(e.preventDefault(),E[h]&&A(E[h]))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,E,h,i,f]),!e)return null;let R=E[h];return(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,t.jsxs)("div",{className:"w-full max-w-4xl h-[80vh] bg-gray-900 border-4 border-gray-700 rounded-lg shadow-2xl flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between border-b-2 border-gray-700 bg-gray-800 px-6 py-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-3xl",children:""}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-yellow-500 font-mono",children:"INVENTORY"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("span",{className:"text-sm text-gray-400 font-mono",children:["Carrying: ",(0,t.jsxs)("span",{className:"text-white font-bold",children:[o.length,"/",c]})]}),(0,t.jsx)("button",{onClick:i,className:"text-gray-400 hover:text-white transition-colors text-2xl",children:""})]})]}),(0,t.jsx)("div",{className:"flex border-b-2 border-gray-700 bg-gray-800",children:["ALL","CONSUMABLES","EQUIPMENT","MISC"].map((e,r)=>(0,t.jsxs)("button",{onClick:()=>g(e),className:(0,s.default)("flex-1 py-3 px-4 font-mono text-sm font-bold transition-all",f===e?"bg-yellow-600 text-white border-b-4 border-yellow-400":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-gray-200"),children:[e," (","ALL"===e?o.length:o.filter(t=>"CONSUMABLES"===e?["POTION","FOOD","SCROLL"].includes(t.item?.type||""):"EQUIPMENT"===e?["WEAPON","ARMOR"].includes(t.item?.type||""):"MISC"===e&&!["POTION","FOOD","SCROLL","WEAPON","ARMOR"].includes(t.item?.type||"")).length,")",(0,t.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["[",r+1,"]"]})]},e))}),(0,t.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,t.jsx)("div",{className:"w-1/2 border-r-2 border-gray-700 bg-gray-850 overflow-y-auto",children:0===E.length?(0,t.jsx)("div",{className:"flex items-center justify-center h-full text-gray-500 font-mono",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-xl mb-2",children:"Empty"}),(0,t.jsx)("p",{className:"text-sm",children:"No items in this category"})]})}):(0,t.jsx)("div",{className:"p-2",children:E.map((e,r)=>{let i=r===h,n=!!e.equipped,a=e.renderable?.char||"?",o=e.renderable?.color||"#fff",l=e.name||"Unknown item";return(0,t.jsxs)("div",{className:(0,s.default)("flex items-center gap-3 p-3 mb-2 rounded transition-all cursor-pointer relative",n&&i?"bg-yellow-600/30 border-l-4 border-blue-400 shadow-lg ring-2 ring-yellow-400":i?"bg-yellow-600/30 border-l-4 border-yellow-400 shadow-lg":n?"bg-blue-900/30 border-l-4 border-blue-400 hover:bg-blue-800/40":"bg-gray-800 hover:bg-gray-750"),onClick:()=>p(r),onDoubleClick:()=>_(e),children:[i&&(0,t.jsx)("div",{className:"text-yellow-400 text-xl font-bold animate-pulse",children:""}),n&&(0,t.jsx)("div",{className:"absolute -left-1 top-1/2 -translate-y-1/2 w-2 h-2 bg-blue-400 rounded-full animate-pulse"}),(0,t.jsx)("div",{className:"text-2xl font-mono w-10 h-10 flex items-center justify-center",style:{color:o},children:a}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"font-mono font-bold",style:{color:"#ffffff"},children:l}),n&&(0,t.jsxs)("div",{className:"text-xs text-blue-400 font-mono mt-1 flex items-center gap-1",children:[(0,t.jsx)("span",{className:"text-blue-400",children:""}),(0,t.jsx)("span",{className:"font-bold",children:"EQUIPPED"})]})]})]},r)})})}),(0,t.jsx)("div",{className:"w-1/2 bg-gray-900 p-6 overflow-y-auto",children:R?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-2xl font-bold font-mono text-yellow-400",children:R.name||"Unknown Item"}),(0,t.jsx)("div",{className:"flex items-center justify-center p-8 bg-gray-800 rounded-lg border-2 border-gray-700",children:(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("div",{className:"text-8xl font-mono",style:{color:R.renderable?.color||"#fff"},children:R.renderable?.char||"?"})})}),(0,t.jsx)("div",{className:"text-sm text-gray-400 italic",children:R.item?.description||"No description available."}),(0,t.jsxs)("div",{className:"space-y-2 border-t-2 border-gray-700 pt-4",children:[(0,t.jsx)("div",{className:"text-xs text-gray-500 font-mono uppercase mb-2",children:"Stats"}),R.consumable&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Effect:"}),(0,t.jsxs)("span",{className:"text-green-400 font-bold",children:["HEAL_HP"===R.consumable.effect&&`Restores ${R.consumable.amount} HP`,"BOOST_ATK"===R.consumable.effect&&`+${R.consumable.amount} ATK`,"BOOST_DEF"===R.consumable.effect&&`+${R.consumable.amount} DEF`]})]}),R.equippable&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Slot:"}),(0,t.jsx)("span",{className:"text-white",children:R.equippable.slot})]}),R.equippable.bonuses.attack&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Attack:"}),(0,t.jsx)("span",{className:R.equippable.bonuses.attack>=0?"text-green-400":"text-red-400",children:x(R.equippable.bonuses.attack)})]}),R.equippable.bonuses.defense&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Defense:"}),(0,t.jsx)("span",{className:R.equippable.bonuses.defense>=0?"text-green-400":"text-red-400",children:x(R.equippable.bonuses.defense)})]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Type:"}),(0,t.jsx)("span",{className:"text-white",children:R.item?.type||"Unknown"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-4",children:[R.consumable&&(0,t.jsx)("button",{onClick:()=>_(R),className:"flex-1 py-3 bg-green-600 hover:bg-green-500 text-white font-mono font-bold rounded transition-colors",children:"USE [U]"}),R.equippable&&(0,t.jsx)(t.Fragment,{children:R.equipped?(0,t.jsx)("button",{onClick:()=>w(R),className:"flex-1 py-3 bg-orange-600 hover:bg-orange-500 text-white font-mono font-bold rounded transition-colors",children:"UNEQUIP [R]"}):(0,t.jsx)("button",{onClick:()=>v(R),className:"flex-1 py-3 bg-blue-600 hover:bg-blue-500 text-white font-mono font-bold rounded transition-colors",children:"EQUIP [E]"})}),(0,t.jsx)("button",{onClick:()=>A(R),className:"flex-1 py-3 bg-red-600 hover:bg-red-500 text-white font-mono font-bold rounded transition-colors",children:"DROP [D]"})]})]}):(0,t.jsx)("div",{className:"flex items-center justify-center h-full text-gray-500",children:(0,t.jsx)("p",{className:"font-mono",children:"Select an item to view details"})})})]}),(0,t.jsx)("div",{className:"border-t-2 border-gray-700 bg-gray-800 px-6 py-3 text-xs text-gray-400 font-mono",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex gap-6",children:[(0,t.jsx)("span",{children:": Navigate Items"}),(0,t.jsx)("span",{children:": Categories"}),(0,t.jsx)("span",{children:"ENTER/U: Use"}),(0,t.jsx)("span",{children:"E: Equip"}),(0,t.jsx)("span",{children:"R: Unequip"}),(0,t.jsx)("span",{children:"D: Drop"})]}),(0,t.jsxs)("div",{className:"flex gap-6",children:[(0,t.jsx)("span",{children:"Home/End: Jump"}),(0,t.jsx)("span",{children:"ESC/I: Close"})]})]})})]}),y&&(0,t.jsx)("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-[10001]",children:(0,t.jsx)("div",{className:"bg-red-600 border-4 border-red-400 rounded-lg px-6 py-4 shadow-2xl animate-pulse",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-3xl",children:""}),(0,t.jsx)("p",{className:"text-white font-mono font-bold",children:y})]})})})]})},W=["HELMET","AMULET","WEAPON","ARMOR","OFFHAND","RING"],U=({isOpen:e,onClose:i,onRerender:n,onSwitchToInventory:a})=>{let[o,l]=(0,r.useState)({}),[c,d]=(0,r.useState)(0),{hp:h,maxHp:u,attack:p,defense:f,level:g,currentXp:y,nextLevelXp:b}=(0,m.useGameStore)(),x=e=>`${e>=0?"+":"-"}${Math.abs(e)}`;if((0,r.useEffect)(()=>{if(e){let e=(0,j.getPlayerEquipment)(),t={};e.forEach(e=>{e.equippable?.slot&&(t[e.equippable.slot]=e)}),l(t)}},[e]),(0,r.useEffect)(()=>{if(!e)return;let t=e=>{if("Escape"===e.key||"c"===e.key.toLowerCase()){e.preventDefault(),i();return}if("i"===e.key.toLowerCase()){e.preventDefault(),a();return}if("ArrowRight"===e.key)e.preventDefault(),c%2==0&&d(Math.min(W.length-1,c+1));else if("ArrowLeft"===e.key)e.preventDefault(),c%2!=0&&d(Math.max(0,c-1));else if("ArrowDown"===e.key)e.preventDefault(),d(Math.min(W.length-1,c+2));else if("ArrowUp"===e.key)e.preventDefault(),d(Math.max(0,c-2));else if("u"===e.key.toLowerCase()){e.preventDefault();let t=o[W[c]];t&&(e=>{if((0,j.unequipItem)(e).success){let e=(0,j.getPlayerEquipment)(),t={};e.forEach(e=>{e.equippable?.slot&&(t[e.equippable.slot]=e)}),l(t),n()}})(t)}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,c,o,i,a]),!e)return null;let E=0,_=0;Object.values(o).forEach(e=>{e.equippable?.bonuses.attack&&(E+=e.equippable.bonuses.attack),e.equippable?.bonuses.defense&&(_+=e.equippable.bonuses.defense)});let v=p-E,w=f-_,A=E>=0?"text-green-400":"text-red-400",O=_>=0?"text-green-400":"text-red-400";return(0,t.jsx)("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center bg-black/80 backdrop-blur-sm",style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1e4,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,t.jsxs)("div",{className:"w-full max-w-4xl h-[70vh] bg-gray-900 border-4 border-gray-700 rounded-lg shadow-2xl flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between border-b-2 border-gray-700 bg-gray-800 px-6 py-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-3xl",children:""}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-yellow-500 font-mono",children:"CHARACTER PROFILE"})]}),(0,t.jsx)("button",{onClick:i,className:"text-gray-400 hover:text-white transition-colors text-2xl",children:""})]}),(0,t.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,t.jsx)("div",{className:"w-1/2 border-r-2 border-gray-700 p-8 bg-gray-850",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-white font-mono mb-4 border-b border-gray-700 pb-2",children:"STATISTICS"}),(0,t.jsxs)("div",{className:"space-y-3 font-mono",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Name:"}),(0,t.jsx)("span",{className:"text-white font-bold",children:"Player"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Level:"}),(0,t.jsx)("span",{className:"text-white font-bold",children:g})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"XP:"}),(0,t.jsxs)("span",{className:"text-white font-bold",children:[y," / ",b]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,t.jsx)("span",{className:"text-gray-400 font-mono",children:"HP"}),(0,t.jsxs)("span",{className:"text-white font-mono font-bold",children:[h," / ",u]})]}),(0,t.jsx)("div",{className:"w-full h-4 bg-gray-700 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-red-600",style:{width:`${Math.min(100,h/u*100)}%`}})})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center bg-gray-800 p-3 rounded",children:[(0,t.jsx)("span",{className:"text-gray-400 font-mono font-bold",children:"ATK (Attack)"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"text-white font-bold text-xl",children:v}),0!==E&&(0,t.jsxs)("span",{className:`${A} text-sm flex items-center`,children:["(",x(E),")"]})]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center bg-gray-800 p-3 rounded",children:[(0,t.jsx)("span",{className:"text-gray-400 font-mono font-bold",children:"DEF (Defense)"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"text-white font-bold text-xl",children:w}),0!==_&&(0,t.jsxs)("span",{className:`${O} text-sm flex items-center`,children:["(",x(_),")"]})]})]})]})]})}),(0,t.jsxs)("div",{className:"w-1/2 p-8 bg-gray-900",children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-white font-mono mb-6 border-b border-gray-700 pb-2",children:"EQUIPMENT"}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-4",children:W.map((e,r)=>{let i=o[e],n=r===c;return(0,t.jsxs)("div",{onClick:()=>d(r),className:(0,s.default)("p-4 border-2 rounded transition-all cursor-pointer min-h-[100px] flex flex-col justify-between",n?"border-yellow-500 bg-yellow-900/20 shadow-[0_0_10px_rgba(234,179,8,0.2)]":"border-gray-700 bg-gray-800 hover:border-gray-500"),children:[(0,t.jsx)("div",{className:"text-xs text-gray-500 font-mono font-bold mb-2",children:e}),i?(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-mono font-bold mb-1 truncate",style:{color:i.renderable?.color||"#fff"},children:[i.renderable?.char," ",i.name]}),(0,t.jsxs)("div",{className:"text-xs font-mono",children:[i.equippable?.bonuses.attack?(0,t.jsxs)("span",{className:i.equippable.bonuses.attack>=0?"text-green-400":"text-red-400",children:[x(i.equippable.bonuses.attack)," ATK"]}):null,i.equippable?.bonuses.attack&&i.equippable?.bonuses.defense?" ":"",i.equippable?.bonuses.defense?(0,t.jsxs)("span",{className:i.equippable.bonuses.defense>=0?"text-green-400":"text-red-400",children:[x(i.equippable.bonuses.defense)," DEF"]}):null]})]}):(0,t.jsx)("div",{className:"text-gray-600 italic font-mono text-sm",children:"(empty)"})]},e)})})]})]}),(0,t.jsx)("div",{className:"border-t-2 border-gray-700 bg-gray-800 px-6 py-3 text-xs text-gray-400 font-mono",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex gap-6",children:[(0,t.jsx)("span",{children:"Arrows: Select Slot"}),(0,t.jsx)("span",{children:"U: Unequip"}),(0,t.jsx)("span",{children:"I: Switch to Inventory"})]}),(0,t.jsx)("div",{className:"flex gap-6",children:(0,t.jsx)("span",{children:"ESC/C: Close"})})]})})]})})},Y={POTION_HEAL_TINY:{id:"POTION_HEAL_TINY",name:"Fiole de Soin Mineure",type:"POTION",rarity:"COMMON",description:"Restaure 15 HP",char:"!",color:"#ffc0cb",sprite:{path:"/assets/sprites/items/consumables/potion.png"},consumable:{effect:"HEAL_HP",amount:15}},POTION_HEAL_SMALL:{id:"POTION_HEAL_SMALL",name:"Potion de Soin Mineure",type:"POTION",rarity:"COMMON",description:"Restaure 30 HP",char:"!",color:"#ff66cc",sprite:{path:"/assets/sprites/items/consumables/potion.png"},consumable:{effect:"HEAL_HP",amount:30}},POTION_HEAL_MEDIUM:{id:"POTION_HEAL_MEDIUM",name:"Potion de Soin",type:"POTION",rarity:"UNCOMMON",description:"Restaure 50 HP",char:"!",color:"#ff0099",sprite:{path:"/assets/sprites/items/consumables/potion.png"},consumable:{effect:"HEAL_HP",amount:50}},POTION_HEAL_LARGE:{id:"POTION_HEAL_LARGE",name:"Potion de Soin Majeure",type:"POTION",rarity:"RARE",description:"Restaure 75 HP",char:"!",color:"#cc0066",sprite:{path:"/assets/sprites/items/consumables/potion.png"},consumable:{effect:"HEAL_HP",amount:75}},POTION_HEAL_FULL:{id:"POTION_HEAL_FULL",name:"lixir de Soin Complet",type:"POTION",rarity:"LEGENDARY",description:"Restaure 100% HP",char:"!",color:"#ff00ff",sprite:{path:"/assets/sprites/items/consumables/potion.png"},consumable:{effect:"HEAL_HP",amount:9999}},POTION_STRENGTH:{id:"POTION_STRENGTH",name:"Potion de Force",type:"POTION",rarity:"RARE",description:"Augmente ATK de 1 de manire permanente",char:"!",color:"#ff6600",sprite:{path:"/assets/sprites/items/consumables/potion.png"},consumable:{effect:"BOOST_ATK",amount:1}},POTION_DEFENSE:{id:"POTION_DEFENSE",name:"Potion de Dfense",type:"POTION",rarity:"RARE",description:"Augmente DEF de 1 de manire permanente",char:"!",color:"#4169e1",sprite:{path:"/assets/sprites/items/consumables/potion.png"},consumable:{effect:"BOOST_DEF",amount:1}},POTION_INVENTORY_EXPAND:{id:"POTION_INVENTORY_EXPAND",name:"Potion d'Extension d'Inventaire",type:"POTION",rarity:"RARE",description:"+1 slot d'inventaire permanent",char:"!",color:"#00ced1",sprite:{path:"/assets/sprites/items/consumables/potion.png"},consumable:{effect:"EXPAND_INVENTORY",amount:1}},FOOD_APPLE:{id:"FOOD_APPLE",name:"Pomme",type:"FOOD",rarity:"COMMON",description:"Restaure 10 HP",char:"%",color:"#ff0000",sprite:{path:"/assets/sprites/items/consumables/food.png"},consumable:{effect:"HEAL_HP",amount:10}},FOOD_BREAD:{id:"FOOD_BREAD",name:"Pain Rassis",type:"FOOD",rarity:"COMMON",description:"Restaure 5 HP",char:"%",color:"#d2691e",sprite:{path:"/assets/sprites/items/consumables/food.png"},consumable:{effect:"HEAL_HP",amount:5}},FOOD_CHEESE:{id:"FOOD_CHEESE",name:"Fromage",type:"FOOD",rarity:"COMMON",description:"Restaure 20 HP",char:"%",color:"#ffff99",sprite:{path:"/assets/sprites/items/consumables/food.png"},consumable:{effect:"HEAL_HP",amount:20}},FOOD_MEAT:{id:"FOOD_MEAT",name:"Viande Sche",type:"FOOD",rarity:"COMMON",description:"Restaure 15 HP",char:"%",color:"#8b4513",sprite:{path:"/assets/sprites/items/consumables/food.png"},consumable:{effect:"HEAL_HP",amount:15}},FOOD_STEW:{id:"FOOD_STEW",name:"Ragot",type:"FOOD",rarity:"UNCOMMON",description:"Restaure 30 HP",char:"%",color:"#cd853f",sprite:{path:"/assets/sprites/items/consumables/food.png"},consumable:{effect:"HEAL_HP",amount:30}},FOOD_ROAST:{id:"FOOD_ROAST",name:"Rti de Sanglier",type:"FOOD",rarity:"UNCOMMON",description:"Restaure 40 HP",char:"%",color:"#8b4513",sprite:{path:"/assets/sprites/items/consumables/food.png"},consumable:{effect:"HEAL_HP",amount:40}},FOOD_FEAST:{id:"FOOD_FEAST",name:"Festin Royal",type:"FOOD",rarity:"RARE",description:"Restaure 50 HP",char:"%",color:"#daa520",sprite:{path:"/assets/sprites/items/consumables/food.png"},consumable:{effect:"HEAL_HP",amount:50}},SWORD_COPPER:{id:"SWORD_COPPER",name:"pe de Cuivre",type:"WEAPON",rarity:"COMMON",description:"+5 ATK, +1 DEF",char:"/",color:"#cd7f32",sprite:{path:"/assets/sprites/items/weapons/sword.png"},equippable:{slot:"WEAPON",bonuses:{attack:5,defense:1}}},SWORD_BRONZE:{id:"SWORD_BRONZE",name:"pe de Bronze",type:"WEAPON",rarity:"UNCOMMON",description:"+8 ATK, +1 DEF",char:"/",color:"#b87333",sprite:{path:"/assets/sprites/items/weapons/sword.png"},equippable:{slot:"WEAPON",bonuses:{attack:8,defense:1}}},SWORD_IRON:{id:"SWORD_IRON",name:"pe de Fer",type:"WEAPON",rarity:"RARE",description:"+12 ATK, +1 DEF",char:"/",color:"#a8a8a8",sprite:{path:"/assets/sprites/items/weapons/sword.png"},equippable:{slot:"WEAPON",bonuses:{attack:12,defense:1}}},SWORD_STEEL:{id:"SWORD_STEEL",name:"pe d'Acier",type:"WEAPON",rarity:"RARE",description:"+16 ATK, +1 DEF",char:"/",color:"#c0c0c0",sprite:{path:"/assets/sprites/items/weapons/sword.png"},equippable:{slot:"WEAPON",bonuses:{attack:16,defense:1}}},SWORD_DIAMOND:{id:"SWORD_DIAMOND",name:"pe de Diamant",type:"WEAPON",rarity:"LEGENDARY",description:"+20 ATK, +1 DEF",char:"/",color:"#b9f2ff",sprite:{path:"/assets/sprites/items/weapons/sword.png"},equippable:{slot:"WEAPON",bonuses:{attack:20,defense:1}}},AXE_COPPER:{id:"AXE_COPPER",name:"Hache de Cuivre",type:"WEAPON",rarity:"COMMON",description:"+7 ATK, -2 DEF",char:"",color:"#cd7f32",sprite:{path:"/assets/sprites/items/weapons/sword.png"},equippable:{slot:"WEAPON",bonuses:{attack:7,defense:-2}}},AXE_BRONZE:{id:"AXE_BRONZE",name:"Hache de Bronze",type:"WEAPON",rarity:"UNCOMMON",description:"+10 ATK, -2 DEF",char:"",color:"#b87333",sprite:{path:"/assets/sprites/items/weapons/sword.png"},equippable:{slot:"WEAPON",bonuses:{attack:10,defense:-2}}},AXE_IRON:{id:"AXE_IRON",name:"Hache de Fer",type:"WEAPON",rarity:"RARE",description:"+14 ATK, -2 DEF",char:"",color:"#a8a8a8",sprite:{path:"/assets/sprites/items/weapons/sword.png"},equippable:{slot:"WEAPON",bonuses:{attack:14,defense:-2}}},AXE_STEEL:{id:"AXE_STEEL",name:"Hache d'Acier",type:"WEAPON",rarity:"RARE",description:"+18 ATK, -2 DEF",char:"",color:"#c0c0c0",sprite:{path:"/assets/sprites/items/weapons/sword.png"},equippable:{slot:"WEAPON",bonuses:{attack:18,defense:-2}}},AXE_DIAMOND:{id:"AXE_DIAMOND",name:"Hache de Diamant",type:"WEAPON",rarity:"LEGENDARY",description:"+22 ATK, -2 DEF",char:"",color:"#b9f2ff",sprite:{path:"/assets/sprites/items/weapons/sword.png"},equippable:{slot:"WEAPON",bonuses:{attack:22,defense:-2}}},SPEAR_COPPER:{id:"SPEAR_COPPER",name:"Lance de Cuivre",type:"WEAPON",rarity:"COMMON",description:"+4 ATK, +3 DEF",char:"",color:"#cd7f32",sprite:{path:"/assets/sprites/items/weapons/sword.png"},equippable:{slot:"WEAPON",bonuses:{attack:4,defense:3}}},SPEAR_BRONZE:{id:"SPEAR_BRONZE",name:"Lance de Bronze",type:"WEAPON",rarity:"UNCOMMON",description:"+7 ATK, +3 DEF",char:"",color:"#b87333",sprite:{path:"/assets/sprites/items/weapons/sword.png"},equippable:{slot:"WEAPON",bonuses:{attack:7,defense:3}}},SPEAR_IRON:{id:"SPEAR_IRON",name:"Lance de Fer",type:"WEAPON",rarity:"RARE",description:"+11 ATK, +3 DEF",char:"",color:"#a8a8a8",sprite:{path:"/assets/sprites/items/weapons/sword.png"},equippable:{slot:"WEAPON",bonuses:{attack:11,defense:3}}},SPEAR_STEEL:{id:"SPEAR_STEEL",name:"Lance d'Acier",type:"WEAPON",rarity:"RARE",description:"+15 ATK, +3 DEF",char:"",color:"#c0c0c0",sprite:{path:"/assets/sprites/items/weapons/sword.png"},equippable:{slot:"WEAPON",bonuses:{attack:15,defense:3}}},SPEAR_DIAMOND:{id:"SPEAR_DIAMOND",name:"Lance de Diamant",type:"WEAPON",rarity:"LEGENDARY",description:"+19 ATK, +3 DEF",char:"",color:"#b9f2ff",sprite:{path:"/assets/sprites/items/weapons/sword.png"},equippable:{slot:"WEAPON",bonuses:{attack:19,defense:3}}},ARMOR_CLOTH_LIGHT:{id:"ARMOR_CLOTH_LIGHT",name:"Armure de Tissu",type:"ARMOR",rarity:"COMMON",description:"+2 DEF, +1 ATK",char:"[",color:"#8b7355",sprite:{path:"/assets/sprites/items/armors/armor.png"},equippable:{slot:"ARMOR",bonuses:{defense:2,attack:1}}},ARMOR_CLOTH_HEAVY:{id:"ARMOR_CLOTH_HEAVY",name:"Armure de Tissu Renforce",type:"ARMOR",rarity:"COMMON",description:"+5 DEF, -1 ATK",char:"[",color:"#654321",sprite:{path:"/assets/sprites/items/armors/armor.png"},equippable:{slot:"ARMOR",bonuses:{defense:5,attack:-1}}},ARMOR_LEATHER_LIGHT:{id:"ARMOR_LEATHER_LIGHT",name:"Armure de Cuir",type:"ARMOR",rarity:"UNCOMMON",description:"+4 DEF, +2 ATK",char:"[",color:"#8b4513",sprite:{path:"/assets/sprites/items/armors/armor.png"},equippable:{slot:"ARMOR",bonuses:{defense:4,attack:2}}},ARMOR_LEATHER_HEAVY:{id:"ARMOR_LEATHER_HEAVY",name:"Armure de Cuir Renforce",type:"ARMOR",rarity:"UNCOMMON",description:"+8 DEF, -2 ATK",char:"[",color:"#808080",sprite:{path:"/assets/sprites/items/armors/armor.png"},equippable:{slot:"ARMOR",bonuses:{defense:8,attack:-2}}},ARMOR_IRON_LIGHT:{id:"ARMOR_IRON_LIGHT",name:"Armure de Fer",type:"ARMOR",rarity:"RARE",description:"+7 DEF, +3 ATK",char:"[",color:"#a8a8a8",sprite:{path:"/assets/sprites/items/armors/armor.png"},equippable:{slot:"ARMOR",bonuses:{defense:7,attack:3}}},ARMOR_IRON_HEAVY:{id:"ARMOR_IRON_HEAVY",name:"Armure de Fer Renforce",type:"ARMOR",rarity:"RARE",description:"+12 DEF, -3 ATK",char:"[",color:"#696969",sprite:{path:"/assets/sprites/items/armors/armor.png"},equippable:{slot:"ARMOR",bonuses:{defense:12,attack:-3}}},ARMOR_STEEL_LIGHT:{id:"ARMOR_STEEL_LIGHT",name:"Armure d'Acier",type:"ARMOR",rarity:"RARE",description:"+10 DEF, +4 ATK",char:"[",color:"#c0c0c0",sprite:{path:"/assets/sprites/items/armors/armor.png"},equippable:{slot:"ARMOR",bonuses:{defense:10,attack:4}}},ARMOR_STEEL_HEAVY:{id:"ARMOR_STEEL_HEAVY",name:"Armure d'Acier Renforce",type:"ARMOR",rarity:"RARE",description:"+17 DEF, -4 ATK",char:"[",color:"#778899",sprite:{path:"/assets/sprites/items/armors/armor.png"},equippable:{slot:"ARMOR",bonuses:{defense:17,attack:-4}}},ARMOR_DIAMOND_LIGHT:{id:"ARMOR_DIAMOND_LIGHT",name:"Armure de Diamant",type:"ARMOR",rarity:"LEGENDARY",description:"+14 DEF, +5 ATK",char:"[",color:"#b9f2ff",sprite:{path:"/assets/sprites/items/armors/armor.png"},equippable:{slot:"ARMOR",bonuses:{defense:14,attack:5}}},ARMOR_DIAMOND_HEAVY:{id:"ARMOR_DIAMOND_HEAVY",name:"Armure de Diamant Renforce",type:"ARMOR",rarity:"LEGENDARY",description:"+23 DEF, -5 ATK",char:"[",color:"#add8e6",sprite:{path:"/assets/sprites/items/armors/armor.png"},equippable:{slot:"ARMOR",bonuses:{defense:23,attack:-5}}},HELMET_CLOTH_LIGHT:{id:"HELMET_CLOTH_LIGHT",name:"Capuche de Tissu",type:"ARMOR",rarity:"COMMON",description:"+1 DEF, +1 ATK",char:"^",color:"#8b7355",sprite:{path:"/assets/sprites/items/armors/helmet.png"},equippable:{slot:"HELMET",bonuses:{defense:1,attack:1}}},HELMET_CLOTH_HEAVY:{id:"HELMET_CLOTH_HEAVY",name:"Capuche de Tissu Renforce",type:"ARMOR",rarity:"COMMON",description:"+2 DEF, -1 ATK",char:"^",color:"#654321",sprite:{path:"/assets/sprites/items/armors/helmet.png"},equippable:{slot:"HELMET",bonuses:{defense:2,attack:-1}}},HELMET_LEATHER_LIGHT:{id:"HELMET_LEATHER_LIGHT",name:"Chapeau de Cuir",type:"ARMOR",rarity:"UNCOMMON",description:"+2 DEF, +1 ATK",char:"^",color:"#8b4513",sprite:{path:"/assets/sprites/items/armors/helmet.png"},equippable:{slot:"HELMET",bonuses:{defense:2,attack:1}}},HELMET_LEATHER_HEAVY:{id:"HELMET_LEATHER_HEAVY",name:"Chapeau de Cuir Renforc",type:"ARMOR",rarity:"UNCOMMON",description:"+4 DEF, -1 ATK",char:"^",color:"#808080",sprite:{path:"/assets/sprites/items/armors/helmet.png"},equippable:{slot:"HELMET",bonuses:{defense:4,attack:-1}}},HELMET_IRON_LIGHT:{id:"HELMET_IRON_LIGHT",name:"Casque de Fer",type:"ARMOR",rarity:"RARE",description:"+3 DEF, +1 ATK",char:"^",color:"#a8a8a8",sprite:{path:"/assets/sprites/items/armors/helmet.png"},equippable:{slot:"HELMET",bonuses:{defense:3,attack:1}}},HELMET_IRON_HEAVY:{id:"HELMET_IRON_HEAVY",name:"Casque de Fer Renforc",type:"ARMOR",rarity:"RARE",description:"+6 DEF, -1 ATK",char:"^",color:"#696969",sprite:{path:"/assets/sprites/items/armors/helmet.png"},equippable:{slot:"HELMET",bonuses:{defense:6,attack:-1}}},HELMET_STEEL_LIGHT:{id:"HELMET_STEEL_LIGHT",name:"Casque d'Acier",type:"ARMOR",rarity:"RARE",description:"+4 DEF, +1 ATK",char:"^",color:"#c0c0c0",sprite:{path:"/assets/sprites/items/armors/helmet.png"},equippable:{slot:"HELMET",bonuses:{defense:4,attack:1}}},HELMET_STEEL_HEAVY:{id:"HELMET_STEEL_HEAVY",name:"Casque d'Acier Renforc",type:"ARMOR",rarity:"RARE",description:"+8 DEF, -1 ATK",char:"^",color:"#778899",sprite:{path:"/assets/sprites/items/armors/helmet.png"},equippable:{slot:"HELMET",bonuses:{defense:8,attack:-1}}},HELMET_DIAMOND_LIGHT:{id:"HELMET_DIAMOND_LIGHT",name:"Casque de Diamant",type:"ARMOR",rarity:"LEGENDARY",description:"+6 DEF, +2 ATK",char:"^",color:"#b9f2ff",sprite:{path:"/assets/sprites/items/armors/helmet.png"},equippable:{slot:"HELMET",bonuses:{defense:6,attack:2}}},HELMET_DIAMOND_HEAVY:{id:"HELMET_DIAMOND_HEAVY",name:"Casque de Diamant Renforc",type:"ARMOR",rarity:"LEGENDARY",description:"+11 DEF, -2 ATK",char:"^",color:"#add8e6",sprite:{path:"/assets/sprites/items/armors/helmet.png"},equippable:{slot:"HELMET",bonuses:{defense:11,attack:-2}}},SHIELD_WOOD_LIGHT:{id:"SHIELD_WOOD_LIGHT",name:"Targe de Bois",type:"ARMOR",rarity:"COMMON",description:"+2 DEF",char:")",color:"#8b4513",sprite:{path:"/assets/sprites/items/armors/shield.png"},equippable:{slot:"OFFHAND",bonuses:{defense:2}}},SHIELD_WOOD_HEAVY:{id:"SHIELD_WOOD_HEAVY",name:"Targe de Bois Renforce",type:"ARMOR",rarity:"COMMON",description:"+4 DEF, -2 ATK",char:")",color:"#654321",sprite:{path:"/assets/sprites/items/armors/shield.png"},equippable:{slot:"OFFHAND",bonuses:{defense:4,attack:-2}}},SHIELD_LEATHER_LIGHT:{id:"SHIELD_LEATHER_LIGHT",name:"cu de Cuir",type:"ARMOR",rarity:"UNCOMMON",description:"+3 DEF",char:")",color:"#654321",sprite:{path:"/assets/sprites/items/armors/shield.png"},equippable:{slot:"OFFHAND",bonuses:{defense:3}}},SHIELD_LEATHER_HEAVY:{id:"SHIELD_LEATHER_HEAVY",name:"cu de Cuir Renforc",type:"ARMOR",rarity:"UNCOMMON",description:"+6 DEF, -2 ATK",char:")",color:"#808080",sprite:{path:"/assets/sprites/items/armors/shield.png"},equippable:{slot:"OFFHAND",bonuses:{defense:6,attack:-2}}},SHIELD_IRON_LIGHT:{id:"SHIELD_IRON_LIGHT",name:"Bouclier de Fer",type:"ARMOR",rarity:"RARE",description:"+5 DEF",char:")",color:"#a8a8a8",sprite:{path:"/assets/sprites/items/armors/shield.png"},equippable:{slot:"OFFHAND",bonuses:{defense:5}}},SHIELD_IRON_HEAVY:{id:"SHIELD_IRON_HEAVY",name:"Bouclier de Fer Renforc",type:"ARMOR",rarity:"RARE",description:"+9 DEF, -3 ATK",char:")",color:"#696969",sprite:{path:"/assets/sprites/items/armors/shield.png"},equippable:{slot:"OFFHAND",bonuses:{defense:9,attack:-3}}},SHIELD_STEEL_LIGHT:{id:"SHIELD_STEEL_LIGHT",name:"Bouclier d'Acier",type:"ARMOR",rarity:"RARE",description:"+7 DEF",char:")",color:"#c0c0c0",sprite:{path:"/assets/sprites/items/armors/shield.png"},equippable:{slot:"OFFHAND",bonuses:{defense:7}}},SHIELD_STEEL_HEAVY:{id:"SHIELD_STEEL_HEAVY",name:"Bouclier d'Acier Renforc",type:"ARMOR",rarity:"RARE",description:"+12 DEF, -3 ATK",char:")",color:"#778899",sprite:{path:"/assets/sprites/items/armors/shield.png"},equippable:{slot:"OFFHAND",bonuses:{defense:12,attack:-3}}},SHIELD_DIAMOND_LIGHT:{id:"SHIELD_DIAMOND_LIGHT",name:"Bouclier de Diamant",type:"ARMOR",rarity:"LEGENDARY",description:"+9 DEF",char:")",color:"#b9f2ff",sprite:{path:"/assets/sprites/items/armors/shield.png"},equippable:{slot:"OFFHAND",bonuses:{defense:9}}},SHIELD_DIAMOND_HEAVY:{id:"SHIELD_DIAMOND_HEAVY",name:"Bouclier de Diamant Renforc",type:"ARMOR",rarity:"LEGENDARY",description:"+16 DEF, -4 ATK",char:")",color:"#add8e6",sprite:{path:"/assets/sprites/items/armors/shield.png"},equippable:{slot:"OFFHAND",bonuses:{defense:16,attack:-4}}},RING_STRENGTH:{id:"RING_STRENGTH",name:"Anneau de Force",type:"MISC",rarity:"UNCOMMON",description:"+3 ATK",char:"=",color:"#ff6347",sprite:{path:"/assets/sprites/items/accessories/ring.png"},equippable:{slot:"RING",bonuses:{attack:3}}},RING_PROTECTION:{id:"RING_PROTECTION",name:"Anneau de Protection",type:"MISC",rarity:"UNCOMMON",description:"+3 DEF",char:"=",color:"#4169e1",sprite:{path:"/assets/sprites/items/accessories/ring.png"},equippable:{slot:"RING",bonuses:{defense:3}}},RING_VITALITY:{id:"RING_VITALITY",name:"Anneau de Vitalit",type:"MISC",rarity:"RARE",description:"+25 MaxHP",char:"=",color:"#32cd32",sprite:{path:"/assets/sprites/items/accessories/ring.png"},equippable:{slot:"RING",bonuses:{maxHp:25}}},RING_BERSERKER:{id:"RING_BERSERKER",name:"Anneau du Berserker",type:"MISC",rarity:"RARE",description:"+6 ATK, -3 DEF",char:"=",color:"#dc143c",sprite:{path:"/assets/sprites/items/accessories/ring.png"},equippable:{slot:"RING",bonuses:{attack:6,defense:-3}}},RING_GUARDIAN:{id:"RING_GUARDIAN",name:"Anneau du Gardien",type:"MISC",rarity:"RARE",description:"+6 DEF, -3 ATK",char:"=",color:"#4682b4",sprite:{path:"/assets/sprites/items/accessories/ring.png"},equippable:{slot:"RING",bonuses:{defense:6,attack:-3}}},AMULET_REGENERATION:{id:"AMULET_REGENERATION",name:"Amulette de Rgnration",type:"MISC",rarity:"RARE",description:"+1 HP/tour",char:'"',color:"#ff69b4",sprite:{path:"/assets/sprites/items/accessories/amulet.png"},equippable:{slot:"AMULET",bonuses:{}}},AMULET_MAGE:{id:"AMULET_MAGE",name:"Amulette du Mage",type:"MISC",rarity:"RARE",description:"+5 ATK, +5 DEF",char:'"',color:"#9370db",sprite:{path:"/assets/sprites/items/accessories/amulet.png"},equippable:{slot:"AMULET",bonuses:{attack:5,defense:5}}},AMULET_LEGENDARY:{id:"AMULET_LEGENDARY",name:"Amulette Lgendaire",type:"MISC",rarity:"LEGENDARY",description:"+10 ATK, +10 DEF",char:'"',color:"#ffd700",sprite:{path:"/assets/sprites/items/accessories/amulet.png"},equippable:{slot:"AMULET",bonuses:{attack:10,defense:10}}}};function X(e){let t=Y[e];if(!t)throw Error(`Unknown item template: ${e}`);return{name:t.name,renderable:{char:t.char,color:t.color,sprite:t.sprite},item:{type:t.type,description:t.description},...t.consumable&&{consumable:t.consumable},...t.equippable&&{equippable:t.equippable}}}let z=[{id:"FOOD_BREAD",weight:12,minFloor:1},{id:"FOOD_MEAT",weight:8,minFloor:1},{id:"FOOD_APPLE",weight:10,minFloor:1},{id:"FOOD_CHEESE",weight:6,minFloor:2},{id:"FOOD_STEW",weight:4,minFloor:4},{id:"FOOD_ROAST",weight:2,minFloor:6},{id:"FOOD_FEAST",weight:1,minFloor:9},{id:"POTION_HEAL_TINY",weight:15,minFloor:1,maxFloor:3},{id:"POTION_HEAL_SMALL",weight:20,minFloor:1,maxFloor:7},{id:"POTION_HEAL_MEDIUM",weight:15,minFloor:3},{id:"POTION_HEAL_LARGE",weight:10,minFloor:6},{id:"POTION_HEAL_FULL",weight:2,minFloor:10},{id:"POTION_STRENGTH",weight:3,minFloor:3},{id:"POTION_DEFENSE",weight:3,minFloor:3},{id:"POTION_INVENTORY_EXPAND",weight:2,minFloor:5},{id:"SWORD_COPPER",weight:10,minFloor:1,maxFloor:4},{id:"AXE_COPPER",weight:8,minFloor:1,maxFloor:4},{id:"SPEAR_COPPER",weight:8,minFloor:1,maxFloor:4},{id:"SWORD_BRONZE",weight:8,minFloor:3,maxFloor:7},{id:"AXE_BRONZE",weight:6,minFloor:3,maxFloor:7},{id:"SPEAR_BRONZE",weight:6,minFloor:3,maxFloor:7},{id:"SWORD_IRON",weight:6,minFloor:6,maxFloor:10},{id:"AXE_IRON",weight:5,minFloor:6,maxFloor:10},{id:"SPEAR_IRON",weight:5,minFloor:6,maxFloor:10},{id:"SWORD_STEEL",weight:4,minFloor:9,maxFloor:13},{id:"AXE_STEEL",weight:3,minFloor:9,maxFloor:13},{id:"SPEAR_STEEL",weight:3,minFloor:9,maxFloor:13},{id:"SWORD_DIAMOND",weight:2,minFloor:12},{id:"AXE_DIAMOND",weight:2,minFloor:12},{id:"SPEAR_DIAMOND",weight:2,minFloor:12},{id:"ARMOR_CLOTH_LIGHT",weight:10,minFloor:1,maxFloor:4},{id:"ARMOR_CLOTH_HEAVY",weight:8,minFloor:1,maxFloor:4},{id:"ARMOR_LEATHER_LIGHT",weight:8,minFloor:3,maxFloor:7},{id:"ARMOR_LEATHER_HEAVY",weight:6,minFloor:3,maxFloor:7},{id:"ARMOR_IRON_LIGHT",weight:6,minFloor:6,maxFloor:10},{id:"ARMOR_IRON_HEAVY",weight:5,minFloor:6,maxFloor:10},{id:"ARMOR_STEEL_LIGHT",weight:4,minFloor:9,maxFloor:13},{id:"ARMOR_STEEL_HEAVY",weight:3,minFloor:9,maxFloor:13},{id:"ARMOR_DIAMOND_LIGHT",weight:2,minFloor:12},{id:"ARMOR_DIAMOND_HEAVY",weight:2,minFloor:12},{id:"HELMET_CLOTH_LIGHT",weight:8,minFloor:2,maxFloor:5},{id:"HELMET_CLOTH_HEAVY",weight:6,minFloor:2,maxFloor:5},{id:"HELMET_LEATHER_LIGHT",weight:6,minFloor:4,maxFloor:8},{id:"HELMET_LEATHER_HEAVY",weight:5,minFloor:4,maxFloor:8},{id:"HELMET_IRON_LIGHT",weight:4,minFloor:6},{id:"HELMET_IRON_HEAVY",weight:3,minFloor:6},{id:"HELMET_STEEL_LIGHT",weight:3,minFloor:9},{id:"HELMET_STEEL_HEAVY",weight:2,minFloor:9},{id:"HELMET_DIAMOND_LIGHT",weight:1,minFloor:12},{id:"HELMET_DIAMOND_HEAVY",weight:1,minFloor:12},{id:"SHIELD_WOOD_LIGHT",weight:8,minFloor:2,maxFloor:5},{id:"SHIELD_WOOD_HEAVY",weight:6,minFloor:2,maxFloor:5},{id:"SHIELD_LEATHER_LIGHT",weight:6,minFloor:4,maxFloor:8},{id:"SHIELD_LEATHER_HEAVY",weight:5,minFloor:4,maxFloor:8},{id:"SHIELD_IRON_LIGHT",weight:4,minFloor:6},{id:"SHIELD_IRON_HEAVY",weight:3,minFloor:6},{id:"SHIELD_STEEL_LIGHT",weight:3,minFloor:9},{id:"SHIELD_STEEL_HEAVY",weight:2,minFloor:9},{id:"SHIELD_DIAMOND_LIGHT",weight:1,minFloor:12},{id:"SHIELD_DIAMOND_HEAVY",weight:1,minFloor:12},{id:"RING_STRENGTH",weight:3,minFloor:5},{id:"RING_PROTECTION",weight:3,minFloor:5},{id:"RING_VITALITY",weight:2,minFloor:6},{id:"RING_BERSERKER",weight:1,minFloor:8},{id:"RING_GUARDIAN",weight:1,minFloor:8},{id:"AMULET_MAGE",weight:2,minFloor:6},{id:"AMULET_REGENERATION",weight:1,minFloor:7},{id:"AMULET_LEGENDARY",weight:1,minFloor:12}];function B(e,t){let r=e.spawnWeight;return"rat"===e.id&&t>5&&(r=Math.max(1,r-(t-5))),e.id,"tiger_white"===e.id&&t>8&&(r+=(t-8)*.5),r}e.s(["GameCanvas",0,()=>{var e;let a=(0,r.useRef)(null),o=(0,r.useRef)(null),l=(0,r.useRef)(null),[c,d]=(0,r.useState)(!1),[y,b]=(0,r.useState)(!1),[x,E]=(0,r.useState)(!1),v=(0,m.useGameStore)(e=>e.lastHitTime),R=(0,m.useGameStore)(e=>e.renderMode),T=(0,r.useCallback)(()=>{let e=l.current;e&&_(e,o.current?.getContext("2d")||void 0)},[]);return(0,r.useEffect)(()=>{if(v>0){E(!0);let e=setTimeout(()=>E(!1),500);return()=>clearTimeout(e)}},[v]),(0,r.useEffect)(()=>{T()},[R,T]),e=(0,r.useCallback)(e=>{if(!l.current)return;if(c){"inventory"===e.type&&d(!1),"character"===e.type&&(d(!1),b(!0));return}if(y){"character"===e.type&&b(!1),"inventory"===e.type&&(b(!1),d(!0));return}let t=u.world.with("player","position"),r=(()=>{for(let e of t)return e;return null})();if(r){if("move"===e.type){let i=function(e,t){let r=function(...e){return u.world.with("player",...e).first||null}("position");if(!r||!r.position)return{kind:"blocked"};let i=r.position.x,s=r.position.y,n=i+e,a=s+t;if(!(0,p.isInBounds)(n,a))return{kind:"blocked"};let o=(0,p.getTile)(n,a);if(null===o||o===p.TileType.WALL)return{kind:"blocked"};let l=O.spatialGrid.getFirstAt(n,a,r);if(l?.dead);else if(l?.monster)return{kind:"attacked",target:l};else if(l&&!l.item&&!l.stairs)return{kind:"blocked"};return r.position.x=n,r.position.y=a,O.spatialGrid.update(r,i,s),{kind:"moved",x:n,y:a}}(e.delta.dx,e.delta.dy);if("attacked"===i.kind)D(r,i.target);else if("blocked"===i.kind)return;m.useGameStore.getState().incrementTurn(),H();let s=(()=>{for(let e of t)return e;return null})();s?.position&&f.fovSystem.compute(s.position.x,s.position.y,8),T();return}if("wait"===e.type){m.useGameStore.getState().incrementTurn(),H();let e=(()=>{for(let e of t)return e;return null})();e?.position&&f.fovSystem.compute(e.position.x,e.position.y,8),T();return}if("pickup"===e.type){!function(){let e=u.world.with("player","position"),t=null;for(let r of e){t=r;break}if(!t||!t.position)return;let r=O.spatialGrid.getAt(t.position.x,t.position.y).filter(e=>e.item&&e!==t);if(0===r.length)return m.useGameStore.getState().addLog("There is nothing here to pick up.","gray");let i=r[0],s=i.name||"Unknown item",n=t.id||"player",a=G(),o=C();a.length>=o?m.useGameStore.getState().addLog("Your inventory is full!","red"):(O.spatialGrid.remove(i),delete i.position,i.inInventory={ownerId:n},m.useGameStore.getState().addLog(`You pick up: ${s}`,"cyan"))}(),m.useGameStore.getState().incrementTurn(),T();return}if("inventory"===e.type)return void d(!0);if("character"===e.type)return void b(!0);if("save"===e.type)return void(0,I.saveGame)();if("descend"===e.type){let e=function(){let e=u.world.with("player","position").first;if(!e||!e.position)return{success:!1,message:"Player not found"};let t=Array.from(u.world.with("stairs","position")).find(t=>t.position.x===e.position.x&&t.position.y===e.position.y);return t?"UP"===t.stairs.direction?{success:!1,message:"The way back is sealed by magic."}:"DOWN"===t.stairs.direction?function(){let e=u.world.with("player","position").first;if(!e)return{success:!1,message:"Player not found"};let t=m.useGameStore.getState();t.nextFloor();let r=t.currentFloor,i=new Set;for(let t of(i.add(e),Array.from(u.world.with("item")).filter(t=>t.inInventory?.ownerId===e.id||t.equipped?.ownerId===e.id)))i.add(t);for(let e of u.world.entities.filter(e=>!i.has(e)))u.world.remove(e);(0,p.resetMap)(),f.fovSystem.reset();let{playerStart:s,rooms:a}=new w().generate();if(e.position={...s},f.fovSystem.compute(e.position.x,e.position.y,8),u.world.add({stairs:{direction:"UP"},position:{...s},renderable:{char:"<",color:"#fff",bg:"#333",sprite:{path:"/assets/sprites/tiles/stairs_up.png"}}}),a.length>1){let e=a[a.length-1],t=Math.floor(e.x+e.w/2),r=Math.floor(e.y+e.h/2);u.world.add({stairs:{direction:"DOWN"},position:{x:t,y:r},renderable:{char:">",color:"#fff",bg:"#333",sprite:{path:"/assets/sprites/tiles/stairs_down.png"}}})}return function(e,t){let r=[];for(let e=0;e<p.mapData.length;e++)p.mapData[e]===p.TileType.FLOOR&&r.push(e);let i=new Set([t.y*n.GRID_WIDTH+t.x]),s=Math.min(15,5+Math.floor(e/1.5));for(let t=0;t<s;t++){let t=r[Math.floor(Math.random()*r.length)];if(i.has(t))continue;i.add(t);let s=t%n.GRID_WIDTH,a=Math.floor(t/n.GRID_WIDTH),o=function(e){let t,r=((t=[]).push(P.rat),e>=2&&t.push(P.slime_green),e>=5&&t.push(P.tiger_white),t),i=Math.random()*r.reduce((t,r)=>t+B(r,e),0);for(let t of r)if((i-=B(t,e))<=0)return t;return r[0]}(e),l=F(o),c=1+.2*Math.sqrt(e-1);u.world.add({monster:!0,name:o.name,ai:{type:o.aiType},position:{x:s,y:a},renderable:{char:o.char,color:o.color,sprite:o.sprite},xpValue:o.xpValue,fighter:{hp:Math.floor(l.hp*c),maxHp:Math.floor(l.hp*c),attack:Math.floor(l.attack*c),defense:Math.floor(o.defense*c)}})}Object.keys(Y);let a=Math.min(10,8+Math.floor(e/3));for(let t=0;t<a;t++){let t=r[Math.floor(Math.random()*r.length)];if(i.has(t))continue;i.add(t);let s=t%n.GRID_WIDTH,a=Math.floor(t/n.GRID_WIDTH),o=X(function(e){let t=z.filter(t=>{let r=t.minFloor<=e,i=void 0===t.maxFloor||t.maxFloor>=e;return r&&i});if(0===t.length)return"FOOD_BREAD";let r=Math.random()*t.reduce((e,t)=>e+t.weight,0);for(let e of t)if((r-=e.weight)<=0)return e.id;return t[0].id}(e));u.world.add({...o,position:{x:s,y:a}})}if(e<=3){let e=u.world.with("item","position").entities.some(e=>e.equippable?.slot==="WEAPON"),t=u.world.with("item","position").entities.some(e=>e.equippable?.slot==="ARMOR");if(!e){let e=r.find(e=>!i.has(e));if(void 0!==e){i.add(e);let t=e%n.GRID_WIDTH,r=Math.floor(e/n.GRID_WIDTH),s=X("SWORD_COPPER");u.world.add({...s,position:{x:t,y:r}})}}if(!t){let e=r.find(e=>!i.has(e));if(void 0!==e){i.add(e);let t=e%n.GRID_WIDTH,r=Math.floor(e/n.GRID_WIDTH),s=X("ARMOR_CLOTH_LIGHT");u.world.add({...s,position:{x:t,y:r}})}}}if(e%5==0){let e=r.find(e=>!i.has(e));if(void 0!==e){i.add(e);let t=e%n.GRID_WIDTH,r=Math.floor(e/n.GRID_WIDTH),s=X("POTION_INVENTORY_EXPAND");u.world.add({...s,position:{x:t,y:r}})}}}(r,s),O.spatialGrid.rebuild(u.world.entities),t.addLog(`You descend to depth ${r}.`,"cyan"),(0,I.saveGame)(),{success:!0,message:`Descended to level ${r}`}}():{success:!1,message:"These stairs go nowhere?"}:{success:!1,message:"No stairs here."}}();e.success?(m.useGameStore.getState().incrementTurn(),T()):m.useGameStore.getState().addLog(e.message,"gray");return}}},[T,c,y]),(0,r.useEffect)(()=>{function t(t){var r,i;if(t.defaultPrevented||function(e){if(!(e instanceof HTMLElement))return!1;if(e.isContentEditable)return!0;let t=e.tagName.toLowerCase();return"input"===t||"textarea"===t||"select"===t}(t.target))return;let s=A[1===(r=t.key).length?r.toLowerCase():r]??null;if(s){t.preventDefault(),e({type:"move",delta:s});return}if(" "===(i=t.key)||"."===i||"5"===i){t.preventDefault(),e({type:"wait"});return}if("g"===t.key.toLowerCase()){t.preventDefault(),e({type:"pickup"});return}if("i"===t.key.toLowerCase()){t.preventDefault(),e({type:"inventory"});return}if("c"===t.key.toLowerCase()){t.preventDefault(),e({type:"character"});return}if("s"===t.key.toLowerCase()){t.preventDefault(),e({type:"save"});return}if("Enter"===t.key||">"===t.key||"."===t.key){t.preventDefault(),e({type:"descend"});return}}return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e]),(0,r.useEffect)(()=>{if(!a.current)return;let e=new i.default({width:n.GRID_WIDTH,height:n.GRID_HEIGHT,fontSize:n.FONT_SIZE,bg:n.BG_COLOR,forceSquareRatio:!0});l.current=e;let t=a.current,r=e.getContainer();if(r&&t.appendChild(r),(0,g.setParticleDisplay)(e),(0,g.setParticleRenderer)(T),o.current&&(o.current.width=n.GRID_WIDTH*n.SPRITE_SIZE,o.current.height=n.GRID_HEIGHT*n.SPRITE_SIZE,h.preloadDefaults().catch(e=>{console.error("Failed to preload default sprites:",e)})),u.world.clear(),(0,p.resetMap)(),f.fovSystem.reset(),(0,I.hasSave)()&&(0,I.loadGame)())return _(e,o.current?.getContext("2d")||void 0),()=>{r&&t.removeChild(r)};let{playerStart:s,rooms:c}=new w().generate(),d={hp:100,maxHp:100,attack:10,defense:5,baseAttack:10,baseDefense:5},y=u.world.add({id:"player",player:!0,name:"Player",position:s,renderable:{char:"@",color:"#ff0",sprite:{path:"/assets/sprites/entities/player/warrior.png"}},fighter:d,inventory:{maxSlots:10,currentSlots:0}});if((0,M.initializeExperience)(y),u.world.add({stairs:{direction:"UP"},position:{...s},renderable:{char:"<",color:"#fff",bg:"#333",sprite:{path:"/assets/sprites/tiles/stairs_up.png"}}}),c.length>1){let e=c[c.length-1],t=Math.floor(e.x+e.w/2),r=Math.floor(e.y+e.h/2);u.world.add({stairs:{direction:"DOWN"},position:{x:t,y:r},renderable:{char:">",color:"#fff",bg:"#333",sprite:{path:"/assets/sprites/tiles/stairs_down.png"}}})}m.useGameStore.getState().setHp(d.hp),m.useGameStore.getState().setMaxHp(d.maxHp),m.useGameStore.getState().setStats({attack:d.attack,defense:d.defense}),m.useGameStore.getState().addLog("Welcome to the dungeon!","cyan");let b=[];for(let e=0;e<p.mapData.length;e++)p.mapData[e]===p.TileType.FLOOR&&b.push(e);let x=new Set([s.y*n.GRID_WIDTH+s.x]),E=Math.min(6,Math.max(0,b.length-1));for(let e=0;e<E;e++){let e=b[Math.floor(Math.random()*b.length)];if(x.has(e))continue;x.add(e);let t=e%n.GRID_WIDTH,r=Math.floor(e/n.GRID_WIDTH),i=function(){let e=Object.values(P),t=Math.random()*e.reduce((e,t)=>e+t.spawnWeight,0);for(let r of e)if((t-=r.spawnWeight)<=0)return r;return e[0]}(),s=F(i);u.world.add({monster:!0,name:i.name,ai:{type:i.aiType},position:{x:t,y:r},renderable:{char:i.char,color:i.color,sprite:i.sprite},xpValue:i.xpValue,fighter:{hp:s.hp,maxHp:s.hp,attack:s.attack,defense:i.defense}})}let v=Object.keys(Y),A=Math.min(8,Math.max(0,b.length-E-1));for(let e=0;e<A;e++){let e=b[Math.floor(Math.random()*b.length)];if(x.has(e))continue;x.add(e);let t=e%n.GRID_WIDTH,r=Math.floor(e/n.GRID_WIDTH),i=Math.random(),s=X(i<.4?"POTION_HEAL_SMALL":i<.7?"FOOD_BREAD":i<.85?"FOOD_MEAT":v[Math.floor(Math.random()*v.length)]);u.world.add({...s,position:{x:t,y:r}})}return O.spatialGrid.rebuild(u.world.entities),f.fovSystem.compute(s.x,s.y,8),_(e,o.current?.getContext("2d")||void 0),()=>{r&&t.removeChild(r)}},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,s.default)("flex flex-col items-center justify-center bg-black p-4 rounded-lg shadow-2xl border border-gray-800 transition-transform",x&&"animate-shake border-red-500"),children:[(0,t.jsxs)("div",{className:"relative overflow-hidden rounded shadow-inner",children:[(0,t.jsx)("div",{ref:a,className:(0,s.default)("overflow-hidden","sprites"===R&&"hidden"),style:{width:"fit-content"}}),(0,t.jsx)("canvas",{ref:o,className:(0,s.default)("pixelated","ascii"===R&&"hidden"),style:{imageRendering:"pixelated"}})]}),(0,t.jsxs)("div",{className:"mt-4 text-xs text-gray-500 font-mono",children:[n.GRID_WIDTH,"x",n.GRID_HEIGHT," Grid - ","ascii"===R?"ASCII":"Sprites"," Mode"]})]}),(0,t.jsx)(q,{isOpen:c,onClose:()=>d(!1),onRerender:T}),(0,t.jsx)(U,{isOpen:y,onClose:()=>b(!1),onRerender:T,onSwitchToInventory:()=>{b(!1),d(!0)}})]})}],35581)},64214,e=>{"use strict";var t=e.i(43476),r=e.i(11742),i=e.i(7670);e.s(["HealthBar",0,()=>{let e=(0,r.useGameStore)(e=>e.hp),s=(0,r.useGameStore)(e=>e.maxHp),n=(0,r.useGameStore)(e=>e.level),a=(()=>{if(s<=0)return 0;let t=e/s*100;return Number.isFinite(t)?Math.max(0,Math.min(100,t)):0})(),o=a<20,l=(0,r.useGameStore)(e=>e.currentFloor);return(0,t.jsxs)("div",{className:"w-64 space-y-1",children:[(0,t.jsx)("div",{className:"flex justify-between items-end mb-2",children:(0,t.jsxs)("span",{className:"text-yellow-500 font-bold font-mono text-xl",children:["FLOOR ",l]})}),(0,t.jsx)("div",{className:"flex justify-between text-xs text-gray-300 font-mono",children:(0,t.jsxs)("span",{children:["HP: ",e," / ",s," LV: ",n]})}),(0,t.jsx)("progress",{className:(0,i.default)("health-progress w-full border-2 border-gray-700",o&&"animate-pulse"),max:s>0?s:1,value:Math.max(0,Math.min(s,e)),style:{color:o?"#dc2626":a<50?"#eab308":"#22c55e"}})]})}])},80239,e=>{"use strict";var t=e.i(43476),r=e.i(11742),i=e.i(71645),s=e.i(7670);let n={white:"text-white",red:"text-red-400",yellow:"text-yellow-400",green:"text-green-400",cyan:"text-cyan-400",purple:"text-purple-400 font-bold",gray:"text-gray-500"};e.s(["MessageLog",0,()=>{let e=(0,r.useGameStore)(e=>e.log),a=(0,i.useRef)(null);(0,i.useEffect)(()=>{a.current&&(a.current.scrollTop=a.current.scrollHeight)},[e]);let o=e.slice(-10);return(0,t.jsxs)("div",{className:"w-full max-w-xl",children:[(0,t.jsx)("div",{className:"text-xs text-gray-400 font-mono mb-1 px-2",children:"COMBAT LOG"}),(0,t.jsx)("div",{ref:a,className:"h-48 bg-black/70 border-2 border-gray-700 rounded p-3 overflow-y-auto backdrop-blur-sm",children:(0,t.jsx)("div",{className:"space-y-1 font-mono text-sm",children:0===o.length?(0,t.jsx)("p",{className:"text-gray-600 italic",children:"No messages yet..."}):o.map((e,r)=>(0,t.jsxs)("div",{className:(0,s.default)("leading-relaxed animate-fade-in",n[e.color]||"text-white"),children:[(0,t.jsx)("span",{className:"text-gray-600 mr-2",children:">"}),e.text]},`${e.turn}-${r}`))})})]})}])},64808,e=>{"use strict";var t=e.i(43476),r=e.i(74080),i=e.i(11742),s=e.i(15089);e.s(["GameOverModal",0,()=>{let{gameStatus:e,currentTurn:n,currentFloor:a}=(0,i.useGameStore)();return"GAME_OVER"!==e?null:(0,r.createPortal)((0,t.jsx)("div",{className:"fixed inset-0 z-[10001] flex items-center justify-center bg-black",style:{position:"fixed",inset:0,zIndex:10001},children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border-4 border-red-800 rounded-lg shadow-2xl w-[80vw] max-w-[460px] text-center opacity-100",style:{backgroundColor:"#000"},children:[(0,t.jsx)("h1",{className:"text-6xl font-bold text-red-600 font-mono mb-2 animate-pulse",children:"YOU DIED"}),(0,t.jsx)("div",{className:"w-full h-1 bg-red-900 mb-6"}),(0,t.jsxs)("div",{className:"space-y-4 mb-8 text-gray-300 font-mono",children:[(0,t.jsx)("p",{className:"text-xl",children:"Your journey ends here."}),(0,t.jsxs)("div",{className:"bg-gray-900 p-4 rounded border border-gray-800",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("p",{className:"text-gray-500 text-sm uppercase mb-1",children:"Depth Reached"}),(0,t.jsxs)("p",{className:"text-3xl text-yellow-500 font-bold",children:["Floor ",a]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-gray-500 text-sm uppercase mb-1",children:"YOU MOVED"}),(0,t.jsxs)("p",{className:"text-3xl text-white font-bold",children:[n," TIMES"]})]})]})]}),(0,t.jsx)("button",{onClick:()=>{(0,s.deleteSave)(),window.location.reload()},className:"px-8 py-4 bg-red-700 hover:bg-red-600 text-white font-bold font-mono text-xl rounded transition-colors shadow-lg w-full",children:"RESTART GAME"})]})}),document.body)}])},22123,e=>{"use strict";var t=e.i(43476),r=e.i(11742),i=e.i(15089);e.s(["VictoryModal",0,()=>{let{gameStatus:e,currentTurn:s}=(0,r.useGameStore)();return"VICTORY"!==e?null:(0,t.jsx)("div",{className:"fixed inset-0 z-[10001] flex items-center justify-center bg-black/90 backdrop-blur-md",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 border-4 border-yellow-500 bg-gray-950 rounded-lg shadow-2xl max-w-lg w-full text-center",children:[(0,t.jsx)("h1",{className:"text-6xl font-bold text-yellow-500 font-mono mb-2 animate-bounce",children:"VICTORY!"}),(0,t.jsx)("div",{className:"w-full h-1 bg-yellow-700 mb-6"}),(0,t.jsxs)("div",{className:"space-y-4 mb-8 text-gray-300 font-mono",children:[(0,t.jsx)("p",{className:"text-xl",children:"You have conquered the dungeon!"}),(0,t.jsxs)("div",{className:"bg-gray-900 p-4 rounded border border-gray-800",children:[(0,t.jsx)("p",{className:"text-gray-500 text-sm uppercase mb-1",children:"Turns Taken"}),(0,t.jsx)("p",{className:"text-3xl text-white font-bold",children:s})]})]}),(0,t.jsx)("button",{onClick:()=>{(0,i.deleteSave)(),window.location.reload()},className:"px-8 py-4 bg-yellow-600 hover:bg-yellow-500 text-white font-bold font-mono text-xl rounded transition-colors shadow-lg w-full",children:"PLAY AGAIN"})]})})}])},74178,e=>{"use strict";var t=e.i(43476),r=e.i(11742),i=e.i(71645);let s=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},n=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,i.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:s,className:o="",children:l,iconNode:c,...d},h)=>(0,i.createElement)("svg",{ref:h,...a,width:t,height:t,stroke:e,strokeWidth:s?24*Number(r)/Number(t):r,className:n("lucide",o),...!l&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(d)&&{"aria-hidden":"true"},...d},[...c.map(([e,t])=>(0,i.createElement)(e,t)),...Array.isArray(l)?l:[l]])),l=(e,t)=>{let r=(0,i.forwardRef)(({className:r,...a},l)=>(0,i.createElement)(o,{ref:l,iconNode:t,className:n(`lucide-${s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...a}));return r.displayName=s(e),r},c=l("monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),d=l("type",[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]]);function h(){let e=(0,r.useGameStore)(e=>e.renderMode),i=(0,r.useGameStore)(e=>e.toggleRenderMode);return(0,t.jsx)("button",{onClick:i,className:"flex items-center gap-2 px-3 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg transition-colors border border-gray-600",title:`Switch to ${"ascii"===e?"Sprite":"ASCII"} mode`,children:"ascii"===e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"ASCII"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Sprites"})]})})}e.s(["RenderModeToggle",()=>h],74178)}]);